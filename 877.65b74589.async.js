(self.webpackChunkbiomedgps_studio=self.webpackChunkbiomedgps_studio||[]).push([[877],{98361:function(Ge,me,t){"use strict";var Ze=t(13254),ie=t(14277),de=t(2824),k=t(43358),ve=t(34041),M=t(96486),Ae=t.n(M),w=t(67294),ne=t(85893),q=ve.Z.Option,ee,z;function I(T,n,ue){console.log("makeQueryStr filter: ",ue);var L=":select [:*]",_="",d="";if(n){var f=Object.keys(n)[0],R=Object.values(n)[0];f&&R&&(R==="ascend"?_=":order-by [:".concat(f,"]"):_=":order-by [[:".concat(f," :desc]]"))}if(T){for(var a=[],E=0,D=Object.keys(T);E<D.length;E++){var J=D[E];["current","pageSize"].indexOf(J)<0&&T[J].length>0&&a.push("[:like [:upper :".concat(J,'] [:upper "%').concat(T[J],'%"]]'))}a.length==1?d=":where ".concat(a[0]):a.length>1&&(d=":where [:or ".concat(a.join(" "),"]"))}return"{".concat(L," ").concat(_," ").concat(d,"}")}var Me=function(n){var ue=n.queryGenes,L=n.initialValue,_=n.dataset,d=(0,w.useState)([]),f=(0,de.Z)(d,2),R=f[0],a=f[1],E=(0,w.useState)([]),D=(0,de.Z)(E,2),J=D[0],H=D[1],te=(0,w.useState)(),Y=(0,de.Z)(te,2),ce=Y[0],h=Y[1];(0,w.useEffect)(function(){L&&L!==ce&&(h(L),ge(L,function(se){H(se),_e(L,{})}))},[L]);var ge=function(g,De){ee&&(clearTimeout(ee),ee=null),z=g;var xe=function(){ue({query_str:I({gene_symbol:g,ensembl_id:g,entrez_id:g},{},{}),dataset:_}).then(function(he){if(z===g){var e=he.data,Ve=e.map(function(Ee){return{value:Ee.ensembl_id,text:"".concat(Ee.gene_symbol," | ").concat(Ee.entrez_id," | ").concat(Ee.ensembl_id)}});De(Ve),a(e)}}).catch(function(he){console.log("requestDEGs Error: ",he),De([])})};ee=setTimeout(xe,300)},Pe=function(g){g?ge(g,H):H([])},_e=function(g,De){if(h(g),console.log("GeneSearcher handleChange: ",g),g&&typeof g=="string"){var xe,Ce=(0,M.filter)(R,function(e){return g.match(/ENS/i)?e.ensembl_id==g:g.match(/[a-zA-Z][a-zA-Z0-9]+/i)?e.gene_symbol==g:g.match(/[0-9]+/i)?e.entrez_id.toString()==g:!1});console.log("handleChange(GeneSearcher): ",Ce,R),(xe=n.onChange)===null||xe===void 0||xe.call(n,g,Ce[0])}else{var he;(he=n.onChange)===null||he===void 0||he.call(n,g,void 0)}},Fe=J.map(function(se){return(0,ne.jsx)(q,{children:se.text},se.value)});return(0,ne.jsx)(ve.Z,{allowClear:!0,showSearch:!0,value:ce,placeholder:n==null?void 0:n.placeholder,style:n.style,defaultActiveFirstOption:!1,showArrow:!0,filterOption:!1,onSearch:Pe,onChange:_e,mode:n!=null&&n.mode?n==null?void 0:n.mode:"single",notFoundContent:(0,ne.jsx)(ie.Z,{description:"Searching ..."}),children:Fe})};me.Z=Me},23082:function(Ge,me,t){"use strict";var Ze=t(13254),ie=t(14277),de=t(2824),k=t(67294),ve=t(70445),M=t(10913),Ae=t(63183),w=t.n(Ae),ne=t(78777),q=t(99251),ee=t(33835),z=t(10043),I=t.n(z),Me=t(22275),T=t(95093),n=t(85893),ue=function(_){var d=_.url,f=_.getFile,R=_.enableToc,a=function(ce){if(ce.match(/^(minio|file):\/\//))return f?f({filelink:ce}).then(function(h){return h}).catch(function(h){return h.data.msg?h.data.msg:h.data}):new Promise(function(h,ge){h("Please specify getFile function.")});try{return(0,T.Z)(ce).then(function(h){return h.status!==200?"No Content.":h.data})}catch(h){return console.log("Cannot fetch ".concat(ce,", the reason is ").concat(h)),new Promise(function(ge,Pe){Pe("No Content.")})}},E=(0,k.useState)(null),D=(0,de.Z)(E,2),J=D[0],H=D[1];(0,k.useEffect)(function(){d&&a(d).then(function(Y){return H(Y||null)})},[d]),console.log("MarkdownViewer: updated");var te=[];return R?te=[M.Z,q.Z,w(),ee.Z,ne.Z]:te=[M.Z,q.Z,ee.Z,ne.Z],J?(0,n.jsx)(ve.D,{rehypePlugins:te,className:"markdown-viewer",remarkPlugins:[I(),Me.Z],children:J},d):(0,n.jsx)(ie.Z,{})};me.Z=(0,k.memo)(ue)},23658:function(Ge,me,t){"use strict";t.d(me,{Z:function(){return n}});var Ze=t(11849),ie=t(69610),de=t(54941),k=t(81306),ve=t(59206),M=t(25478),Ae=t.n(M),w=t(67294),ne=t(66979),q=t.n(ne),ee=t(58660),z=t(74310),I=t(75503),Me=t.n(I),T=t(85893),n=function(ue){(0,k.Z)(_,ue);var L=(0,ve.Z)(_);function _(d){var f;return(0,ie.Z)(this,_),f=L.call(this,d),f.handleUpdate=function(R,a,E){f.props.handleUpdate&&f.props.handleUpdate({data:R,layout:a,frames:E})},f.handleRender=function(R,a,E){f.props.handleUpdate&&f.props.handleUpdate({data:R,layout:a,frames:E})},f.handleResize=function(){f.ref.state.graphDiv instanceof HTMLElement&&M.Plots.resize(f.ref.state.graphDiv)},f.ref=void 0,f}return(0,de.Z)(_,[{key:"render",value:function(){var f=this,R={toImageButtonOptions:{format:"svg",filename:"custom_image",height:1e3,width:1e3,scale:1},editable:!0,scrollZoom:!1,displaylogo:!1,displayModeBar:!0,showTips:!0,responsive:!0,locales:{"zh-CN":I},locale:(0,z.Kd)()};console.log("PlotlyViewer updated: ",this.props.mode);var a=this.props.plotlyData||{data:[],layout:{}},E=a.data,D=a.layout,J=a.frames;return D=(0,Ze.Z)((0,Ze.Z)({},D),{},{margin:{t:50,r:50,b:50,l:50}}),this.props.mode==="Plotly"?(0,T.jsx)(ee.Z,{ref:function(te){f.ref=te},useResizeHandler:!0,className:"plotly-viewer",data:E,layout:D,config:R}):(0,T.jsx)("div",{className:"plotly-editor",children:(0,T.jsx)(q(),{ref:function(te){f.ref=te},data:E,layout:D,config:R,frames:J,plotly:M,onUpdate:this.handleUpdate,onRender:this.handleRender,useResizeHandler:!0,debug:!0,advancedTraceTypeSelector:!0})})}}]),_}(w.PureComponent)},42877:function(Ge,me,t){"use strict";t.d(me,{Z:function(){return Kt}});var Ze=t(20228),ie=t(11382),de=t(13062),k=t(71230),ve=t(89032),M=t(15746),Ae=t(43358),w=t(34041),ne=t(13254),q=t(14277),ee=t(34792),z=t(48086),I=t(11849),Me=t(9715),T=t(55843),n=t(2824),ue=t(18106),L=t(63885),_=t(21349),d=t(74310),f=t(15873),R=t(68628),a=t(67294),E=t(39428),D=t(3182),J=t(49111),H=t(19650),te=t(22385),Y=t(94199),ce=t(57663),h=t(71577),ge=t(8212),Pe=t(84391),_e=t(90631),Fe=t(54787),se=t(19412),g=t(53674),De=t(98361),xe=t(50220),Ce={import:{id:"stat-engine.argument-form.import",defaultMessage:"\u5BFC\u5165"},importTooltip:{id:"stat-engine.argument-form.import-tooltip",defaultMessage:"\u5BFC\u5165\u53C2\u6570\u6587\u4EF6"},export:{id:"stat-engine.argument-form.export",defaultMessage:"\u5BFC\u51FA"},exportTooltip:{id:"stat-engine.argument-form.export-tooltip",defaultMessage:"\u5BFC\u51FA\u53C2\u6570"}},he=null,e=t(85893),Ve=function(l){var v=l.columns,c=l.height,x=l.labelSpan,p=l.onSubmit,A=l.queryGenes,m=l.fieldsValue,F=l.defaultDataset,G=(0,e.jsx)(xe.Z,{label:"Editor",style:{width:"50%"},labelCol:{span:6},wrapperCol:{span:18},children:(0,e.jsxs)(h.Z,{style:{width:"100%"},children:[(0,e.jsx)(ge.Z,{}),"Edit"]})}),N=(0,a.useState)("QueryFilter"),$=(0,n.Z)(N,2),W=$[0],O=$[1],V=T.Z.useForm(),P=(0,n.Z)(V,1),B=P[0],X=(0,d.YB)(),u={};Object.keys(Ce).forEach(function(r){u[r]=X.formatMessage(Ce[r])}),(0,a.useEffect)(function(){B.resetFields()},[v]),(0,a.useEffect)(function(){m&&B.setFieldsValue(m)},[m]),console.log("ArgumentForm updated");var i=(0,a.useContext)(Fe.L_);return v.length>0?(0,e.jsx)(k.Z,{className:"argument-form",children:(0,e.jsxs)(Fe.L_.Provider,{value:(0,I.Z)((0,I.Z)({},i),{},{valueTypeMap:{gene_searcher:{render:function(o){return(0,e.jsx)("a",{children:o})},renderFormItem:function(o,s){var U,y;console.log("Gene Searcher Component: ",s,B.getFieldValue(s==null?void 0:s.id));var S=B.getFieldValue(s==null?void 0:s.id);return(0,e.jsx)(De.Z,(0,I.Z)((0,I.Z)({placeholder:"Enter gene symbol, entrez id or ensembl id",dataset:F,queryGenes:A,initialValue:S||(s==null||(U=s.formItemProps)===null||U===void 0?void 0:U.initialValue)},s==null?void 0:s.fieldProps),{},{mode:s==null||(y=s.fieldProps)===null||y===void 0?void 0:y.mode,style:{width:"100%"}}))}}}}),children:[(0,e.jsxs)(M.Z,{className:"argument-form__header",style:{display:"none"},children:[(0,e.jsx)(se.Z,{label:"Layout",labelCol:{span:8},wrapperCol:{span:16},options:["ModalForm","QueryFilter"],fieldProps:{value:W,onChange:function(o){return O(o)}}}),(0,e.jsxs)(H.Z,{className:"btn-group",style:{display:"none"},children:[(0,e.jsx)(Y.Z,{title:u.importTooltip,children:(0,e.jsx)(h.Z,{disabled:!0,icon:(0,e.jsx)(Pe.Z,{}),children:"".concat(u.import)})}),(0,e.jsx)(Y.Z,{title:u.exportTooltip,children:(0,e.jsx)(h.Z,{disabled:!0,icon:(0,e.jsx)(_e.Z,{}),children:"".concat(u.export)})})]})]}),(0,e.jsx)(g.Z,{className:"schema-form vertical",trigger:G,style:{height:c},span:x,form:B,defaultCollapsed:!1,layoutType:W,layout:"vertical",onFinish:function(){var r=(0,D.Z)((0,E.Z)().mark(function o(s){return(0,E.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:p&&p(s).then(function(S){console.log("onSubmit ArgumentForm: ",S)}).catch(function(S){console.log("onSubmit ArgumentForm Error: ",S)});case 1:case"end":return y.stop()}},o)}));return function(o){return r.apply(this,arguments)}}(),columns:v})]})}):(0,e.jsx)(q.Z,{})},Ee=(0,a.memo)(Ve),it=t(23082),dt=function(l){var v=l.HoverHandler,c=l.ClickHandler,x=l.btnActive,p=l.style,A=l.className;return console.log("Resizer updated"),(0,e.jsx)(M.Z,{style:p,className:"resizer ".concat(A),onMouseEnter:function(){v(!0)},onMouseLeave:function(){v(!1)},children:x?(0,e.jsxs)(H.Z,{children:[(0,e.jsx)(h.Z,{onClick:function(){c(12)},className:"resize-btn btn-1",size:"small",children:"1:1"}),(0,e.jsx)(h.Z,{onClick:function(){c(16)},className:"resize-btn btn-2",size:"small",children:"2:1"}),(0,e.jsx)(h.Z,{onClick:function(){c(8)},className:"resize-btn btn-3",size:"small",children:"1:2"}),(0,e.jsx)(h.Z,{onClick:function(){c(24)},className:"resize-btn btn-4",size:"small",children:"Full"})]}):null})},ut=(0,a.memo)(dt),Ht=t(57338),ke=t(273),qe=t(57820),ct=t(34654),ht=t(21444),et=t(93179),ft=t(73888),Gt=t(71153),mt=t(60331),Vt=t(54421),Je=t(38272),vt=t(58812),gt=t(81825),xt=t(25559),yt=t(96486),Ct=t(51615),Oe=t(16629),tt={totalItems:{id:"stat-engine.chart-list.totalItems",defaultMessage:"\u603B\u6570"}},kt=null,Et=function(l){var v=l.onClickItem,c=(0,a.useState)([]),x=(0,n.Z)(c,2),p=x[0],A=x[1],m=(0,a.useState)(0),F=(0,n.Z)(m,2),G=F[0],N=F[1],$=(0,Ct.k6)(),W=(0,d.YB)(),O={};Object.keys(tt).forEach(function(u){O[u]=W.formatMessage(tt[u])}),(0,a.useEffect)(function(){(0,Oe.HN)({}).then(function(u){var i=(0,yt.filter)(u.data,function(r){return r.category==="Chart"});A(i),N(i.length)})},[]);var V=function(i){var r=i.icon,o=i.text;return(0,e.jsxs)(H.Z,{children:[a.createElement(r),o]})},P=function(i){return"".concat(O.totalItems,": ").concat(i)},B=function(i){return i[0].src?i[0].src:""},X=function(i,r){return(0,e.jsx)("a",{className:"title",children:"".concat(i,"- ").concat(r)})};return console.log("ChartList updated"),(0,e.jsx)(Je.ZP,{className:"chart-list",itemLayout:"vertical",size:"large",grid:{xs:1,sm:1,md:1,lg:1,xl:2,xxl:2},pagination:{onChange:function(i){console.log(i)},pageSize:10,total:G,showTotal:P,showSizeChanger:!0,showQuickJumper:!0},dataSource:p,renderItem:function(i){return(0,e.jsxs)(Je.ZP.Item,{className:"chart-item",onClick:function(){v?v(i,void 0,void 0):$.push("/stat-engine/index",{chart:i,result:null})},actions:[(0,e.jsx)(V,{icon:vt.Z,text:"156"},"list-vertical-star-o"),(0,e.jsx)(V,{icon:gt.Z,text:"1"},"list-vertical-like-o"),(0,e.jsx)(V,{icon:xt.Z,text:"2"},"list-vertical-message")],extra:(0,e.jsx)("img",{alt:"logo",src:B(i.icons)}),children:[(0,e.jsx)(Je.ZP.Item.Meta,{title:X(i.name,i.version),description:i.maintainers}),(0,e.jsx)("span",{className:"description",children:i.description}),i.tags.map(function(r){return(0,e.jsx)(mt.Z,{children:r},r)})]},i.short_name)}})},jt=(0,a.memo)(Et),St=t(25592),Zt=t(22732),Mt=function(l){var v=l.url,c=l.height,x=l.getFile,p=(0,a.useState)(""),A=(0,n.Z)(p,2),m=A[0],F=A[1],G=(0,e.jsxs)(H.Z,{style:{marginTop:"5px",display:"flex",justifyContent:"flex-end"},children:[(0,e.jsx)(h.Z,{icon:(0,e.jsx)(St.Z,{}),children:"Force Update"}),(0,e.jsx)(h.Z,{icon:(0,e.jsx)(_e.Z,{}),children:"Download"})]}),N=function(){if(v.length>0)var W=setInterval(function(){x({filelink:v}).then(function(O){console.log("Load Log: ",O),F(O.msg),clearInterval(W)}).catch(function(O){console.log("Fetch log error, the reason is ".concat(O)),F("Cannot get the log, please retry later."),clearInterval(W)})},1e3)};return(0,a.useEffect)(N,[v]),console.log("LogViewer updated"),v?m?(0,e.jsxs)(M.Z,{className:"log-container",children:[(0,e.jsx)(Zt.ZP,{bodyStyle:{height:c,overflowY:"auto"},log:m}),G]}):(0,e.jsx)(M.Z,{className:"spinning",children:(0,e.jsx)(ie.Z,{})}):(0,e.jsx)(q.Z,{})},Pt=(0,a.memo)(Mt),_t=t(23658),at=t(93224),Dt=t(70844),Ot=t(16894),It=t(12826),Tt=["defaultRender"],Lt=["defaultRender"];function nt(le){return Promise.resolve((0,I.Z)((0,I.Z)({},le),{},{success:!0}))}var Rt=function(l){var v=l.onClickItem,c=l.pluginName,x=l.forceUpdateKey,p=(0,a.useState)(!1),A=(0,n.Z)(p,2),m=A[0],F=A[1],G=(0,a.useState)(),N=(0,n.Z)(G,2),$=N[1];(0,a.useEffect)(function(){$("")},[x]);var W=(0,a.useRef)(),O=(0,a.useState)(),V=(0,n.Z)(O,2),P=V[0],B=V[1],X=function(){var r=(0,D.Z)((0,E.Z)().mark(function o(s,U,y){var S;return(0,E.Z)().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return S={page:s.current,pape_size:s.pageSize},c&&(S.plugin_name=c),y.status&&(S.status=y.status),s.status&&(S.status=s.status),console.log("List Tasks: ",S,s),ae.next=7,(0,Oe.Ak)(S).then(function(re){return nt(re)}).catch(function(re){return console.log("requestDEGs Error: ",re),nt({total:0,page:1,page_size:10,data:[]})});case 7:return ae.abrupt("return",ae.sent);case 8:case"end":return ae.stop()}},o)}));return function(s,U,y){return r.apply(this,arguments)}}(),u=(0,d.YB)(),i=[{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.id",defaultMessage:"Task ID"}),dataIndex:"id",tip:"The task id is the unique key",hideInTable:!1,hideInSearch:!0,hideInForm:!0,render:function(o,s){return(0,e.jsx)("a",{onClick:function(){v&&v(s.plugin_name,s.response,s)},children:o})}},{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.taskName",defaultMessage:"Task Name"}),dataIndex:"name",hideInSearch:!0,hideInForm:!0,hideInTable:!0,tip:"The task name is the unique key",render:function(o,s){return(0,e.jsx)("a",{onClick:function(){B(s),F(!0)},children:o})}},{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.pluginName",defaultMessage:"Chart Name"}),dataIndex:"plugin_name",valueType:"text",render:function(o,s){return(0,e.jsx)("a",{onClick:function(){B(s),F(!0)},children:o})}},{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.pluginVersion",defaultMessage:"Version"}),dataIndex:"plugin_version",hideInSearch:!0,hideInForm:!0,valueType:"text"},{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.percentage",defaultMessage:"Percentage"}),dataIndex:"percentage",hideInSearch:!0,hideInForm:!0,hideInTable:!0,hideInSetting:!0,valueType:"progress"},{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.status",defaultMessage:"Status"}),dataIndex:"status",hideInForm:!0,valueEnum:{Started:{text:(0,e.jsx)(d._H,{id:"stat-engine.history-table.started",defaultMessage:"Started"}),status:"Processing"},Finished:{text:(0,e.jsx)(d._H,{id:"stat-engine.history-table.finished",defaultMessage:"Finished"}),status:"Success"},Failed:{text:(0,e.jsx)(d._H,{id:"stat-engine.history-table.failed",defaultMessage:"Failed"}),status:"Error"}}},{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.startedAt",defaultMessage:"Started"}),dataIndex:"started_time",hideInSearch:!0,valueType:"dateTime",renderFormItem:function(o,s,U){var y=s.defaultRender,S=(0,at.Z)(s,Tt);return y(o)}},{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.finishedAt",defaultMessage:"Finished"}),hideInSearch:!0,dataIndex:"finished_time",valueType:"dateTime",renderFormItem:function(o,s,U){var y=s.defaultRender,S=(0,at.Z)(s,Lt);return y(o)}},{title:(0,e.jsx)(d._H,{id:"stat-engine.history-table.payload",defaultMessage:"Payload"}),dataIndex:"payload",hideInSearch:!0,hideInForm:!0,hideInTable:!0,hideInSetting:!0,valueType:"jsonCode",renderText:function(o,s,U,y){return JSON.stringify(o)},colSpan:2}];return(0,e.jsxs)(Dt.ZP,{className:"history-table-page-container",children:[(0,e.jsx)(Ot.ZP,{className:"history-table",headerTitle:u.formatMessage({id:"stat-engine.history-table.title",defaultMessage:"Task History"}),actionRef:W,rowKey:"id",search:{labelWidth:120},toolBarRender:function(){return[]},request:X,columns:i}),(0,e.jsx)(ke.Z,{width:"50%",visible:m,className:"task-details",onClose:function(){B(void 0),F(!1)},closable:!1,children:(P==null?void 0:P.name)&&(0,e.jsx)(It.ZP,{column:1,title:P==null?void 0:P.name,request:(0,D.Z)((0,E.Z)().mark(function r(){return(0,E.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",{data:P||{}});case 1:case"end":return s.stop()}},r)})),params:{id:P==null?void 0:P.name},columns:i})})]})},pt=Rt,st=t(618),At=t(83461),Be=t(14066),lt={figure:{id:"stat-engine.result-panel.figure",defaultMessage:"\u4EA4\u4E92\u56FE\u8868"},results:{id:"stat-engine.result-panel.results",defaultMessage:"\u7ED3\u679C"},data:{id:"stat-engine.result-panel.data",defaultMessage:"\u6570\u636E"},download:{id:"stat-engine.result-panel.download",defaultMessage:"\u4E0B\u8F7D"},metadata:{id:"stat-engine.result-panel.metadata",defaultMessage:"\u5143\u6570\u636E"},log:{id:"stat-engine.result-panel.log",defaultMessage:"\u65E5\u5FD7"},edit:{id:"stat-engine.result-panel.edit",defaultMessage:"\u7F16\u8F91"},charts:{id:"stat-engine.result-panel.charts",defaultMessage:"\u56FE\u8868\u5E93"},history:{id:"stat-engine.result-panel.history",defaultMessage:"\u5386\u53F2\u8BB0\u5F55"}},Jt=null,Ue=L.Z.TabPane,Ft=function(l,v){var c="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(l)),x=document.getElementById(v);x?(x.setAttribute("href",c),x.setAttribute("download","metadata.json"),x.click()):console.log("No such html tag ".concat(v)),console.log("Download ".concat(v))},Bt=function(l){var v=(0,d.YB)(),c={};Object.keys(lt).forEach(function(C){c[C]=v.formatMessage(lt[C])});var x=l.onClickItem,p=l.logLink,A=l.responsiveKey,m=l.currentChart,F=l.taskId,G=l.results,N=l.charts,$=(0,a.useState)(void 0),W=(0,n.Z)($,2),O=W[0],V=W[1],P=(0,a.useState)("Plotly"),B=(0,n.Z)(P,2),X=B[0],u=B[1],i=(0,a.useState)(!1),r=(0,n.Z)(i,2),o=r[0],s=r[1],U=(0,a.useState)(!1),y=(0,n.Z)(U,2),S=y[0],Ie=y[1],ae=(0,a.useState)(!1),re=(0,n.Z)(ae,2),Ne=re[0],Te=re[1],Qe=(0,a.useState)("chart"),Le=(0,n.Z)(Qe,2),Re=Le[0],Ke=Le[1],Ye=(0,a.useState)(null),be=(0,n.Z)(Ye,2),je=be[0],$e=be[1],We=(0,a.useState)(null),K=(0,n.Z)(We,2),Se=K[0],Xe=K[1];(0,a.useEffect)(function(){N.length>0&&(console.log("Chart Task: ",F),(0,Be.nj)({filelink:N[0]}).then(function(C){Xe({data:C.data,layout:C.layout,frames:C.frames||void 0})}).catch(function(C){z.ZP.warn("Cannot fetch the result, please retry later.")}))},[N]),(0,a.useEffect)(function(){G.length>0&&(console.log("Data: ",F),(0,Be.nj)({filelink:G[0]}).then(function(C){$e(C)}).catch(function(C){z.ZP.warn("Cannot fetch the result, please retry later.")}))},[G]),(0,a.useEffect)(function(){p.length>0?Ie(!0):Ie(!1)},[p]);var ze=(0,e.jsxs)(H.Z,{children:[(0,e.jsx)(Y.Z,{title:"Edit the Chart",children:(0,e.jsx)(h.Z,{disabled:!S,style:Re==="chart"?{}:{display:"none"},type:"primary",icon:(0,e.jsx)(ge.Z,{}),onClick:function(){u("PlotlyEditor")},children:c.edit})}),(0,e.jsx)(Y.Z,{title:"List all charts",children:(0,e.jsx)(h.Z,{style:{display:"none"},onClick:function(){s(!0)},icon:(0,e.jsx)(qe.Z,{}),children:c.charts})}),(0,e.jsx)(Y.Z,{title:"List all history",children:(0,e.jsx)(h.Z,{onClick:function(){Te(!0)},icon:(0,e.jsx)(ct.Z,{}),children:c.history})})]});return console.log("ResultPanel updated"),(0,e.jsxs)(k.Z,{className:"result-panel",children:[(0,e.jsxs)(L.Z,{onChange:function(oe){Ke(oe)},activeKey:Re,className:"tabs-result",tabBarExtraContent:ze,children:[(0,e.jsx)(Ue,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(qe.Z,{}),c.figure]}),children:(0,e.jsxs)(M.Z,{id:"graph-container",className:`result-container
        `.concat(X==="PlotlyEditor"?"full-screen":"no-full-screen"),children:[X==="PlotlyEditor"?(0,e.jsxs)(h.Z,{className:"exit-editor",onClick:function(){u("Plotly")},children:[(0,e.jsx)(ht.Z,{}),"Exit Editor"]}):null,(0,e.jsx)(_t.Z,{responsiveKey:A,plotlyData:Se,mode:X},N[0])]})},"chart"),(0,e.jsx)(Ue,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(et.Z,{}),c.log]}),children:(0,e.jsx)(Pt,{getFile:Be.nj,height:"calc(100vh - 200px)",url:p})},"log"),je?(0,e.jsxs)(Ue,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(ft.Z,{}),c.data]}),children:[(0,e.jsxs)(At.CSVLink,{data:je,filename:"data.csv",className:"button",children:[c.download," ",c.data]}),(0,e.jsx)(st.he,{value:je})]},"data"):null,O?(0,e.jsxs)(Ue,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(et.Z,{}),c.metadata]}),children:[(0,e.jsxs)("a",{className:"button",onClick:function(){Ft(O,"download-anchor")},children:[c.download," ",c.metadata]}),(0,e.jsx)("a",{id:"download-anchor",style:{display:"none"}}),(0,e.jsx)(st.he,{value:O})]},"metadata"):null]}),(0,e.jsx)(ke.Z,{title:"Chart Store",placement:"right",closable:!0,width:"70%",onClose:function(){s(!1)},visible:o,children:(0,e.jsx)(jt,{onClickItem:function(oe,pe,ye){x(oe.short_name,pe,ye),s(!1)}})}),(0,e.jsx)(ke.Z,{title:"Chart History",placement:"right",closable:!0,className:"history-table-drawer",width:"70%",onClose:function(){Te(!1)},visible:Ne,children:(0,e.jsx)(pt,{forceUpdateKey:"".concat(Ne),pluginName:m||void 0,onClickItem:function(oe,pe,ye){x(oe,pe,ye?ye.payload:void 0),Te(!1),V(ye)}})})]})},Ut=(0,a.memo)(Bt),rt={resetTooltip:{id:"stat-engine.reset-tooltip",defaultMessage:"\u91CD\u7F6E\u6570\u636E\u4E0E\u53C2\u6570"},reset:{id:"stat-engine.reset",defaultMessage:"\u91CD\u7F6E"},exampleTooltip:{id:"stat-engine.example-tooltip",defaultMessage:"\u52A0\u8F7D\u793A\u4F8B\u6570\u636E"},example:{id:"stat-engine.example",defaultMessage:"\u793A\u4F8B"},loadData:{id:"stat-engine.load-data",defaultMessage:"\u52A0\u8F7D\u6570\u636E"},summary:{id:"stat-engine.summary",defaultMessage:"\u6587\u6863"},arguments:{id:"stat-engine.arguments",defaultMessage:"\u53C2\u6570\u5217\u8868"}},Qt=null,ot=L.Z.TabPane,Nt=function(l){var v=l.queryGenes,c=(0,d.YB)();console.log("StatEngine Props: ",l);var x={};Object.keys(rt).forEach(function(b){x[b]=c.formatMessage(rt[b])});var p=(0,a.useState)(8),A=(0,n.Z)(p,2),m=A[0],F=A[1],G=(0,a.useState)(!1),N=(0,n.Z)(G,2),$=N[0],W=N[1],O=(0,a.useState)("arguments"),V=(0,n.Z)(O,2),P=V[0],B=V[1],X=(0,d.tT)("dataset",function(b){return{defaultDataset:b.defaultDataset,setDataset:b.setDataset}}),u=X.defaultDataset,i=(0,a.useState)(""),r=(0,n.Z)(i,2),o=r[0],s=r[1],U=(0,a.useState)(""),y=(0,n.Z)(U,2),S=y[0],Ie=y[1],ae=(0,a.useState)([]),re=(0,n.Z)(ae,2),Ne=re[0],Te=re[1],Qe=(0,a.useState)({}),Le=(0,n.Z)(Qe,2),Re=Le[0],Ke=Le[1],Ye=T.Z.useForm(),be=(0,n.Z)(Ye,1),je=be[0];(0,a.useEffect)(function(){je.setFieldsValue({dataset:u})},[u]);var $e=(0,a.useState)({results:[],charts:[],task_id:"",log:""}),We=(0,n.Z)($e,2),K=We[0],Se=We[1],Xe=(0,a.useState)(!1),ze=(0,n.Z)(Xe,2),C=ze[0],oe=ze[1];(0,a.useEffect)(function(){var b=l.chart;s(b||"boxplot")},[l.chart]);var pe=function(Z,Q,j){(0,Oe.lM)({chart_name:Q,dataset:Z}).then(function(He){var fe=(0,I.Z)({},He.schema);Ie("".concat(He.readme,"?=").concat((Math.random()+1).toString(36).substring(7))),Te(fe.fields),j&&Ke(j)})},ye=function(Z,Q,j){console.log("Restore Chart: ",Z,Q,j),j&&(Ke(j),s(Z)),Se(Q||void 0)},bt=function(Z){B(Z)},Wt=function(Z){var Q=setInterval(function(){Z.length>0&&(0,Oe.gJ)({id:Z}).then(function(j){j.status==="Finished"?(Se({results:j.response.results,charts:j.response.charts,log:j.response.log,task_id:j.response.task_id}),oe(!1),z.ZP.success("Load chart..."),clearInterval(Q)):j.status==="Failed"&&(Se({results:j.response.results,charts:j.response.charts,log:j.response.log,task_id:j.response.task_id}),oe(!1),z.ZP.error("Something wrong, please check the log for more details."),clearInterval(Q))}).catch(function(j){console.log("Get Task Error: ",j),clearInterval(Q)})},1e3)},zt=function(Z){var Q=o||"";return console.log("onSubmit Chart: ",o,Z),Z=(0,I.Z)((0,I.Z)({},Z),{},{dataset:u}),new Promise(function(j,He){(0,Oe.Qn)({chart_name:Q},Z).then(function(fe){console.log("Post Chart: ",fe),z.ZP.success("Create the chart ".concat(Q," successfully.")),oe(!0),Wt(fe.task_id),j(fe)}).catch(function(fe){z.ZP.warn("Unknown error, please retry later."),console.log("Post Chart Error: ",fe),He(fe)})})},we=function(Z){return 24-Z?24-Z:24};return(0,a.useEffect)(function(){o&&u&&pe(u,o,Re)},[o,u]),(0,e.jsx)(_.Z,{children:(0,e.jsx)(ie.Z,{spinning:C,style:{marginTop:"50px"},children:(0,e.jsxs)(k.Z,{className:"stat-engine",gutter:8,children:[(0,e.jsx)(M.Z,{className:"left",xxl:m,xl:m,lg:m,md:24,sm:24,xs:24,children:(0,e.jsxs)(k.Z,{className:"left__content",children:[(0,e.jsx)(M.Z,{className:"left__tabs",children:(0,e.jsxs)(L.Z,{onChange:function(Z){bt(Z)},activeKey:P,defaultActiveKey:"arguments",className:"left__tabs__arguments",children:[(0,e.jsxs)(ot,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(f.Z,{}),x.arguments]}),children:[(0,e.jsx)(T.Z,{layout:"vertical",form:je,children:(0,e.jsx)(T.Z.Item,{shouldUpdate:!0,label:"Data Set",name:"dataset",initialValue:u,rules:[{required:!0,message:"Please select a dataset!"}],children:(0,e.jsx)(w.Z,{allowClear:!0,showSearch:!0,placeholder:"Select a dataset",defaultActiveFirstOption:!1,showArrow:!0,filterOption:!1,options:[{value:"".concat(u),label:"".concat(u)}],disabled:!0,notFoundContent:(0,e.jsx)(q.Z,{description:"No Dataset"})})})}),(0,e.jsx)(Ee,{defaultDataset:u,queryGenes:v,fieldsValue:Re,labelSpan:24,height:"calc(100% - 10px)",onSubmit:zt,columns:Ne})]},"arguments"),(0,e.jsx)(ot,{tab:(0,e.jsxs)("span",{children:[(0,e.jsx)(R.Z,{}),x.summary]}),children:(0,e.jsx)(it.Z,{getFile:Be.nj,url:S})},"summary")]})}),(0,e.jsx)(ut,{className:"left__divider",HoverHandler:W,ClickHandler:F,btnActive:$})]})}),(0,e.jsx)(M.Z,{className:"right",xxl:we(m),xl:we(m),lg:we(m),md:24,sm:24,xs:24,children:(0,e.jsx)(k.Z,{className:"right__content",children:(0,e.jsx)(Ut,{currentChart:o,results:(K==null?void 0:K.results)||[],charts:(K==null?void 0:K.charts)||[],taskId:(K==null?void 0:K.task_id)||"",responsiveKey:m,logLink:(K==null?void 0:K.log)||"",onClickItem:ye})})})]})})})},Kt=Nt}}]);
