(self.webpackChunkbiomedgps_studio=self.webpackChunkbiomedgps_studio||[]).push([[344],{73460:function(Da,jt,d){"use strict";d.r(jt),d.d(jt,{default:function(){return si}});var Nt=d(13062),X=d(71230),ge=d(57663),W=d(71577),Ne=d(89032),we=d(15746),S=d(2824),Ht=d(22325),hn=d(20228),$t=d(11382),wt=d(66456),Ye=d(15885),kt=d(13254),ke=d(14277),Pt=d(22385),ut=d(94199),Et=d(18106),ve=d(63885),m=d(11849),me=d(86582),It=d(34792),Y=d(48086),Tt=d(71153),Ae=d(60331),Dt=d(71194),et=d(50146),l=d(67294),Mt=d(53110),ft=d(57119),vn=d(21444),tt=d(38296),Gt=d(24616),ht=d(90841),Qt=d(62298),nt=d(19671),Ma=d(57338),vt=d(273),t=d(85893),pt=function(e){var n=e.position,a=e.onClick,o=(0,l.useState)(!1),r=(0,S.Z)(o,2),i=r[0],s=r[1];(0,l.useEffect)(function(){e.visible&&s(e.visible)},[e.visible]);var c=function(){e.onClose&&e.onClose(),s(!i)},u={right:{right:"0px",top:"45%",height:"80px",width:"38px",borderColor:"transparent #ddd transparent transparent"},top:{top:"0px",left:"45%",width:"80px",height:"38px",borderColor:"#ddd transparent transparent transparent"},left:{left:"0px",top:"45%",height:"80px",width:"38px",borderColor:"transparent transparent transparent #ddd"},bottom:{left:"45%",bottom:"0px",width:"80px",height:"38px",borderColor:"transparent transparent #ddd transparent"}},Z={right:{left:"5px",top:"8px"},top:{top:"-20px",left:"40%"},bottom:{left:"15px",top:"0px"},left:{left:"-15px",top:"8px"}},b=n||"right",y=u[b]?u[b]:u.right,h=Z[b]?Z[b]:Z.right;return(0,t.jsxs)("div",{className:"toolbar",children:[(0,t.jsx)("div",{style:(0,m.Z)({zIndex:10,position:"absolute",cursor:"pointer",borderStyle:"solid",borderWidth:"20px"},y),onClick:function(){console.log("Show Drawer: ",b),c(),a&&a(b)},children:(0,t.jsx)("span",{style:(0,m.Z)({position:"absolute"},h),children:b==="top"||b==="bottom"?"=":"||"})}),(0,t.jsx)(vt.Z,{width:e.width?e.width:"300px",height:e.height?e.height:"300px",title:e.title?e.title:!1,getContainer:!1,style:{position:"absolute"},closable:e.closable?e.closable:!1,mask:e.maskVisible?e.maskVisible:!1,placement:n,onClose:c,open:i,children:i?e.children:null})]})},_e=pt,se=d(96486),pn=d(77576),Ee=d(12028),A=d(98858),G=d(4914),te=d(91220),oe=d(43358),w=d(34041),at=d(30887),Ze=d(18515),rt=d(42134),Ot=d(82735),Ue=d(98818),Ie=d(36950),gn=(0,l.createContext)({}),qi=d(20136),mn=d(55241),Ga=d(29154),Oa=d(84387),La=d(54549),Ra=function(e){var n=(0,l.useRef)(null),a=(0,l.useRef)(null);return(0,l.useEffect)(function(){if(a.current){var o=a.current;o.addEventListener("click",function(){console.log("Focus the explanation panel"),o.style.zIndex="10";for(var r=document.getElementsByClassName("explanation-panel"),i=0;i<r.length;i++){var s=r[i];s!==o&&(s.style.zIndex="2")}})}},[a.current]),(0,t.jsxs)("div",{className:"explanation-panel",ref:a,style:{top:e.top||"200px",right:e.right||e.width||"400px"},children:[(0,t.jsxs)("div",{ref:n,style:{position:"absolute",width:e.width||"400px",maxWidth:"auto",maxHeight:"auto"},className:"explanation-content",children:[(0,t.jsxs)("div",{className:"explanation-title",children:[(0,t.jsx)("h3",{children:e.title||"Explanation"}),e.help?(0,t.jsx)(mn.Z,{content:e.help,title:"Help",placement:"topRight",children:(0,t.jsx)(Oa.Z,{})}):null,e.onClose?(0,t.jsx)(La.Z,{className:"explanation-close",onClick:function(){var r;(r=e.onClose)===null||r===void 0||r.call(e)}}):null]}),(0,t.jsx)("div",{className:"explanation-info",children:e.children})]}),(0,t.jsx)(Ga.ZP,{target:n,draggable:!0,throttleDrag:1,edgeDraggable:!1,startDragRotate:0,throttleDragRotate:0,onDrag:function(r){r.target.style.transform=r.transform},resizable:!0,keepRatio:!1,throttleResize:1,renderDirections:["nw","n","ne","w","e","sw","s","se"],onResize:function(r){r.target.style.width="".concat(r.width,"px"),r.target.style.height="".concat(r.height,"px"),r.target.style.transform=r.drag.transform}})]})},Lt=Ra,Rt=d(4714),Fa=d(49346),Pe=d(50651),yn=d(40847),Aa=d(55076),xn=d(57820),za=d(43396),Zn=d(20015),Yt=d(93181),Ba=d(7364),Sn=d(1870),Va=d(71938),Ua=d(62876),Wa=d(73218),Ka=d(43587),Ft=d(33182),Ha=d(93695),bn=d(95357),At=d(82738),$a=d(90631),Qa=d(73171),Ya=function(e){var n=e.data,a=e.style,o=n.map(function(r,i){return(0,t.jsx)(G.Z.Item,{label:r[0],children:r[1]},i)});return o.length>0?(0,t.jsx)(G.Z,{size:"small",column:2,title:null,labelStyle:{backgroundColor:"transparent"},bordered:!0,style:(0,m.Z)({},a),children:o}):(0,t.jsx)("span",{style:a,children:"No Properties"})},_a=Ya,Cn=d(93224),He=d(81209),Ja=["source","target"],Xa=function(e,n){var a=new Map;e.forEach(function(r){var i=r.source,s=r.target,c="".concat(i,"-").concat(s);if(a.has(c)){var u=a.get(c);u&&a.set(c,[].concat((0,me.Z)(u),[r]))}else a.set(c,[r])});var o=[];return a.forEach(function(r,i){if(r.length>1){var s=(0,S.Z)(r,1),c=s[0],u=c.source,Z=c.target,b=(0,Cn.Z)(c,Ja),y=r.map(function(h){return h.reltype});o.push((0,m.Z)((0,m.Z)({source:u,target:Z},b),{},{reltype:y.join("|"),relid:"MultipleLabels-".concat(u,"-").concat(Z),style:(0,m.Z)((0,m.Z)({},b.style),{},{label:{value:"MultipleLabels"}}),data:(0,m.Z)((0,m.Z)({},b.data),{},{identity:"MultipleLabels-".concat(u,"-").concat(Z),reltypes:y})}))}else o.push(r[0])}),o},jn=function(e,n){var a=[];e.map(function(s){a=a.concat(Object.keys(s))});var o=[],r=(0,se.uniq)(a),i=(0,se.filter)(r,function(s){return n.indexOf(s)<0});return i.map(function(s){o.push({title:He.Z.titleCase(s),key:s,dataIndex:s,align:"center",ellipsis:!0})}),o},Nn=function(e){return e.map(function(n){return wn(n)})},_t=function(e,n){var a={},o=Object.keys(e),r=(0,se.filter)(o,function(i){return n?n.indexOf(i)<0:!0});return r.forEach(function(i){["string","number","boolean"].indexOf(typeof e[i])>=0&&(a[i]=e[i])}),a},wn=function(e,n){return e.data?(0,m.Z)((0,m.Z)({},_t(e,n)),_t(e.data,n)):_t(e)};function kn(g,e,n){console.log("makeQueryStr filter: ",n);var a=":select [:*]",o="",r="";if(e){var i=Object.keys(e)[0],s=Object.values(e)[0];i&&s&&(s==="ascend"?o=":order-by [:".concat(i,"]"):o=":order-by [[:".concat(i," :desc]]"))}if(g){for(var c=[],u=0,Z=Object.keys(g);u<Z.length;u++){var b=Z[u];["current","pageSize"].indexOf(b)<0&&g[b].length>0&&c.push("[:like [:upper :".concat(b,'] [:upper "%').concat(g[b],'%"]]'))}c.length==1?r=":where ".concat(c[0]):c.length>1&&(r=":where [:or ".concat(c.join(" "),"]"))}return"{".concat(a," ").concat(o," ").concat(r,"}")}function Ge(g,e,n,a){var o=n||"n,m,r",r={match:g,where:e,return:o};return a!==void 0&&(r=(0,m.Z)((0,m.Z)({},r),{},{limit:a||50})),r}var el=function(e,n){var a=n.filter(function(r){return r}),o={match:"(n)",where:"ID(n) in [".concat(a,"]"),return:"n"};return new Promise(function(r,i){e.postGraph({query_map:o}).then(function(s){s?r(s):i(s)}).catch(function(s){i(s)})})};function qa(g,e){var n=e.map(function(i){return{id:parseInt(i.id),label:i.nlabel}}),a=JSON.stringify(n,null).replace(/"([^"]+)":/g,"$1:"),o=JSON.stringify(e.map(function(i){return parseInt(i.id)}),null),r={with:"".concat(a," as nodeList, ").concat(o," as idList"),unwind:"nodeList AS node",match:"(n)-[r]-(m)",where:"node.label in labels(n) and ID(n) = node.id and ID(m) in idList",return:"n,m,r"};return new Promise(function(i,s){g.postGraph({query_map:r}).then(function(c){c?i(c):s(c)}).catch(function(c){s(c)})})}var Pn=function(){return"<>"},En=function(e,n,a,o){var r=Pn();return e.indexOf("::")>=0?e:[e,n,a,o].join(r)};function In(g){for(var e=[],n=Pn(),a=0;a<g.length;a++){var o=g[a].split(n),r=(0,S.Z)(o,4),i=r[0],s=r[1],c=r[2],u=r[3],Z={relationshipType:i,sourceNodeType:c,targetNodeType:u,resource:s};e.push(Z)}return e}var Tn=function(e){var n=0;return e.forEach(function(a){var o=a.toString().length;o>n&&(n=o)}),n},er=function(e){var n=[],a=Tn(e.map(function(o){return o.relation_count}));return e.forEach(function(o){var r=o.relation_count.toString().padStart(a,"0"),i=En(o.relation_type,o.source,o.start_node_type,o.end_node_type);n.push({order:o.relation_count,label:"[".concat(r,"] ").concat(i),value:i})}),n.sort(function(o,r){return o.order-r.order})},Dn=function(e){var n=e.mode,a=e.node_type,o=e.node_id;return!!(n=="node"&&a&&o)},Mn=function(e){var n=e.mode,a=e.node_ids;return!!(n=="batchIds"&&a&&a.length>0)},Gn=function(e){var n=e.mode,a=e.node_id,o=e.node_type;return!!(n=="similarity"&&a&&o)},On=function(e){var n=e.mode,a=e.nodes,o=e.node_type;return!!(n=="batchNodes"&&a&&a.length>0&&o)},Ln=function(e){var n=e.mode,a=e.nodes;return!!(n=="path"&&a&&a.length>0)},tr=function(e){return!!(Dn(e)||Mn(e)||Gn(e)||On(e)||Ln(e))};function nr(g,e){console.log("makeGraphQueryStrWithSearchObject: ",e);var n=e.node_type,a=e.node_id,o=e.relation_types,r=e.all_relation_types,i=e.enable_prediction,s=e.limit,c=e.mode,u=e.node_ids,Z=e.topk,b=e.nodes;return new Promise(function(y,h){var N={},p={},x=s||50;if(c=="node"||c=="batchIds"||c=="batchNodes"||c=="path"){if(Dn(e))if(p=Ge("(n:".concat(n,")-[r]-(m)"),"n.id = '".concat(a,"'"),void 0,x),!o||(o==null?void 0:o.length)==0){e.nsteps&&e.nsteps<=1?p=Ge("(n:".concat(n,")-[r]-(m)"),"n.id = '".concat(a,"'"),void 0,x):p=Ge("(n:".concat(n,")-[r*1..").concat(e.nsteps,"]-(m)"),"n.id = '".concat(a,"'"),"n,r,m",x);var E=r?r.filter(function(F){return F.match(n||"")}):[],j=In(E),M=j.map(function(F){return"'".concat(F.relationshipType,"'")});N={source_id:"".concat(a),relation_types:M,topk:10,enable_prediction:i}}else{var C=In(o),L=C.filter(function(F){return F.targetNodeType}),J="";if(L.length>0){var D=(0,se.uniq)(C.map(function(F){return"m:".concat(F.targetNodeType)})).join(" or ");J=D?"( ".concat(D," ) and "):""}var I=C.filter(function(F){return F.resource}),O="";if(I.length>0){var K=(0,se.uniq)(C.map(function(F){return"'".concat(F.resource,"'")})).join(",");O=K?"r.resource in [".concat(K,"] and "):""}var H=(0,se.uniq)(C.map(function(F){return F.relationshipType})),$=H.map(function(F){return"type(r) = '".concat(F,"'")}).join(" or "),ce=$?"( ".concat($," )"):"",Se="".concat(J," ").concat(O," ").concat(ce);e.nsteps&&e.nsteps<=1?p=Ge("(n:".concat(n,")-[r]-(m)"),"n.id = '".concat(a,"' and ").concat(Se),void 0,x):p=Ge("(n:".concat(n,")-[r*1..").concat(e.nsteps,"]-(m)"),"n.id = '".concat(a,"' and ").concat(Se),void 0,x),N={source_id:a,relation_types:H,topk:Z||10,enable_prediction:i}}if(Mn(e)){var pe=u==null?void 0:u.filter(function(F){return F}).map(function(F){return"'".concat(F,"'")}).join(",");p=Ge("(n)","n.id in [".concat(pe,"]"),"n",x)}if(On(e)){var B=(0,se.uniq)(b==null?void 0:b.map(function(F){return"(n.id = '".concat(F.data.id,"' and n:").concat(F.nlabel,")")})).join(" or "),Q="";if(e.relation_types&&e.relation_types.length>0){var xe=(0,se.uniq)(e.relation_types.map(function(F){return"'".concat(F,"'")})).join(",");Q=xe?"type(r) in [".concat(xe,"]"):""}if(e.query_mode=="each"){var ye="(".concat(B,") ").concat(Q?"and "+Q:""),be=Q?"WHERE ".concat(Q):"",De="CALL { WITH n MATCH (n)-[r]-(m:".concat(n,") ").concat(be,"  RETURN m LIMIT ").concat(x," }");p=Ge("(n)-[r]-(:".concat(n,")"),"".concat(ye," ").concat(De),"n,r,m")}else p=Ge("(n)-[r]-(m:".concat(n,")"),"".concat(B," ").concat(Q),"n,r,m",x)}if(Ln(e)){var le=e.nodes,Te=e.nsteps,Me=(0,se.uniq)(le==null?void 0:le.map(function(F){return"(n.id = '".concat(F.data.id,"' and n:").concat(F.nlabel,")")})).join(" or "),Ce=(0,se.uniq)(le==null?void 0:le.map(function(F){return"(m.id = '".concat(F.data.id,"' and m:").concat(F.nlabel,")")})).join(" or "),Be="(".concat(Me,") ").concat(Te&&Te==1?"and":"or"," (").concat(Ce,")");p=Ge("(n)-[r*1..".concat(Te||3,"]-(m)"),Be,"n,r,m",x)}console.log("query_str: ",p),Object.keys(p).length>0?g.postGraph((0,m.Z)({query_map:p},N)).then(function(F){F?y(F):h(F)}).catch(function(F){h(F)}):y({nodes:[],edges:[]})}Gn(e)&&g.postSimilarity({source_type:n,source_id:"".concat(a),topk:Z||10}).then(function(F){console.log("Find similar nodes: ",F),F?y(F):h(F)}).catch(function(F){console.log("Error when finding similar nodes: ",F),h(F)})})}var tl=function(e,n,a){return new Promise(function(o,r){n&&a?e.postGraph({query_map:Ge("(n:".concat(n,")-[r]-(m)"),"n.id = '".concat(a,"'"))}).then(function(i){i?o(i):r(i)}).catch(function(i){r(i)}):o({nodes:[],edges:[]})})},ar=function(e,n,a){return new Promise(function(o,r){var i=n.split("::")[1],s=a.map(function(c){return"'".concat(c.split("::")[1],"'")}).join(",");e.postGraph({query_map:Ge("(n)-[r]-(m)","n.id = '".concat(i,"' and m.id in [").concat(s,"]")),source_id:n,target_ids:a,enable_prediction:!0}).then(function(c){c?o(c):r(c)}).catch(function(c){r(c)})})},rr={type:"grid"},or={type:"graphin-force",workerEnabled:!1,gpuEnabled:!1,animation:!0,preset:{type:"force"},clustering:!0,leafCluster:!0,preventOverlap:!0,nodeClusterBy:"nlabel",clusterNodeStrength:40,minNodeSpacing:20,nodeSize:40,defSpringLen:function(e,n,a){var o,r,i=40,s=(o=n.data.layout)===null||o===void 0?void 0:o.degree,c=(r=a.data.layout)===null||r===void 0?void 0:r.degree,u=Math.min(s,c);return u===1?i*4:Math.min(u*i*1.5,200)},getId:function(e){return e.id},getHeight:function(){return 16},getWidth:function(){return 16},getVGap:function(){return 80},getHGap:function(){return 50}},gt=[{type:"preset"},{type:"auto"},(0,m.Z)({},or),{type:"force",workerEnabled:!1,gpuEnabled:!1,animation:!0,preset:{type:"grid"},clustering:!0,leafCluster:!0,preventOverlap:!0,clusterAttr:"nlabel",nodeClusterBy:"nlabel",clusterNodeStrength:40,minNodeSpacing:20,nodeSize:40,defSpringLen:function(e,n,a){var o,r,i=40,s=(o=n.data.layout)===null||o===void 0?void 0:o.degree,c=(r=a.data.layout)===null||r===void 0?void 0:r.degree,u=Math.min(s,c);return u===1?i*4:Math.min(u*i*1.5,200)},getId:function(e){return e.id},getHeight:function(){return 16},getWidth:function(){return 16},getVGap:function(){return 80},getHGap:function(){return 50}},{type:"grid",begin:[0,0],preventOverlap:!0,preventOverlapPdding:20,nodeSize:30,condense:!1,rows:5,cols:5,sortBy:"degree",workerEnabled:!1},{type:"radial",center:[200,200],linkDistance:80,maxIteration:1e3,sortBy:"degree",unitRadius:150,preventOverlap:!0,nodeSize:30,strictRadial:!1,workerEnabled:!1},{type:"concentric",center:[200,200],preventOverlap:!0,nodeSize:30,sweep:10,minNodeSpacing:5,equidistant:!0,startAngle:0,clockwise:!0,maxLevelDiff:.5,sortBy:"degree",workerEnabled:!1}],ir=function(e){var n=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;return n.test(e)},zt=function(e){if(!e)return[];var n=e.getNodes().filter(function(a){return a.hasState("selected")});return n.map(function(a){return a.getModel()})},lr=function(e){if(!e)return[];var n=e.getNodes();return n.map(function(a){return a.getModel()})},Rn=function(e){var n={nodes:e.getNodes().map(function(o){var r=o.getModel();return(0,m.Z)((0,m.Z)({},r),{},{style:r._initialStyle,_initialStyle:r.style})}),edges:e.getEdges().map(function(o){var r=o.getModel();return(0,m.Z)((0,m.Z)({},r),{},{style:r._initialStyle,_initialStyle:r.style})})},a=e.get("layout");return{data:n,layout:{type:"preset"},defaultLayout:a}},nl=d(74379),Jt=d(38648),al=d(49111),Xt=d(19650),rl=d(47673),Bt=d(4107),Je=d(32059),sr=d(37763),dr=d.n(sr),Fn=d(76570),cr=d(92570),ur=d(72850);function fr(g,e,n,a,o){for(var r=[],i=[{nodeId:g,path:[g]}],s=new Set([g]),c=new Set,u=function(){var b=i.shift(),y=b.nodeId,h=b.path;if(y===e){for(var N=h.map(function(D){var I=n.find(function(O){return O.id===D});return I?I.id:n[0].id}),p=[],x=function(I){var O=n.find(function($){return $.id===h[I-1]}),K=n.find(function($){return $.id===h[I]});if(O&&K){var H=a.find(function($){return $.source===O.id&&$.target===K.id||$.source===K.id&&$.target===O.id});H?p.push(H.relid):p.push("")}},E=1;E<h.length;E++)x(E);var j=N.join(",")+":"+p.join(",");c.has(j)||(r.push({nodes:N,edges:p}),c.add(j))}else{var M=o.get(y)||[],C=(0,te.Z)(M),L;try{for(C.s();!(L=C.n()).done;){var J=L.value;s.has(J)||(s.add(J),i.push({nodeId:J,path:[].concat((0,me.Z)(h),[J])}))}}catch(D){C.e(D)}finally{C.f()}}};i.length>0;)u();return r}function hr(g,e,n,a,o){var r=[],i=[];function s(c){if(r.push(c),c===e)i.push({nodes:r.map(function(h){var N=n.find(function(p){return p.id===h});return N?N.id:n[0].id}),edges:r.slice(1).map(function(h,N){var p=n.find(function(j){return j.id===r[N]}),x=n.find(function(j){return j.id===h});if(p&&x){var E=a.find(function(j){return j.source===p.id&&j.target===x.id||j.source===x.id&&j.target===p.id});return E?E.relid:""}else return""})});else{var u=o.get(c)||[],Z=(0,te.Z)(u),b;try{for(Z.s();!(b=Z.n()).done;){var y=b.value;!r.includes(y)&&r.length<=3&&s(y)}}catch(h){Z.e(h)}finally{Z.f()}}r.pop()}return s(g),i}var vr=function(e){var n=(0,l.useState)(""),a=(0,S.Z)(n,2),o=a[0],r=a[1],i=(0,l.useState)(""),s=(0,S.Z)(i,2),c=s[0],u=s[1],Z=l.useRef(null),b=l.useRef(null),y=(0,l.useContext)(Ie.Z),h=y.graph,N=(0,l.useState)({}),p=(0,S.Z)(N,2),x=p[0],E=p[1],j=(0,l.useState)({}),M=(0,S.Z)(j,2),C=M[0],L=M[1],J=(0,l.useState)(null),D=(0,S.Z)(J,2),I=D[0],O=D[1],K=(0,l.useState)(!1),H=(0,S.Z)(K,2),$=H[0],ce=H[1],Se=(0,l.useState)([]),pe=(0,S.Z)(Se,2),B=pe[0],Q=pe[1];(0,l.useEffect)(function(){if(!(e.selectedNodes.length<=1)){var q=e.selectedNodes[0].id,_=(0,te.Z)(e.selectedNodes),ee;try{var T=function(){var f=ee.value,k=q+"_"+f.id;if(!x[k]){var V=e.algorithm=="bfs"?fr:hr,U=V(e.selectedNodes[0].id,f.id,e.nodes,e.edges,e.adjacencyList);E(function(ae){return(0,m.Z)((0,m.Z)({},ae),{},(0,Je.Z)({},k,U))}),L(function(ae){return(0,m.Z)((0,m.Z)({},ae),{},(0,Je.Z)({},k,e.algorithm))})}};for(_.s();!(ee=_.n()).done;)T()}catch(v){_.e(v)}finally{_.f()}}},[e.selectedNodes]),(0,l.useEffect)(function(){for(var q=[],_=0,ee=Object.keys(x);_<ee.length;_++)for(var T=ee[_],v=0;v<x[T].length;v++)q.push({key:T,index:v,path:x[T][v].nodes.map(function(f){var k=e.nodes.find(function(V){return V.id===f});return k?k.data.name:"Unknown"}).join(" -> "),nsteps:x[T][v].edges.length});Q((0,se.uniqBy)((0,se.sortBy)(q,["nsteps"]),"path"))},[x]);function xe(q){ye();var _=q.some(function(k){return k.nodes.length>0});(q.length===0||!_)&&Y.ZP.warning("No path found");var ee=(0,me.Z)(new Set(q.flatMap(function(k){return k.nodes}))),T=(0,me.Z)(new Set(q.flatMap(function(k){return k.edges}))),v=h.getNodes();v.forEach(function(k){var V=k.getModel();V.id&&!ee.includes(V.id)?h.setItemState(k,"inactive",!0):h.setItemState(k,"active",!0)});var f=h.getEdges();f.forEach(function(k){var V=k.getModel();V.relid&&!T.includes(V.relid)?h.setItemState(k,"inactive",!0):h.setItemState(k,"active",!0)})}function ye(){var q=h.getNodes();q.forEach(function(ee){h.setItemState(ee,"inactive",!1)});var _=h.getEdges();_.forEach(function(ee){h.setItemState(ee,"inactive",!1)})}function be(q){var _=(0,me.Z)(new Set(q.flatMap(function(f){return f.nodes}))),ee=(0,me.Z)(new Set(q.flatMap(function(f){return f.edges}))),T=h.getNodes();T.forEach(function(f){var k=f.getModel();k.id&&!_.includes(k.id)?h.setItemState(f,"inactive",!1):h.setItemState(f,"active",!1)});var v=h.getEdges();v.forEach(function(f){var k=f.getModel();k.relid&&!ee.includes(k.relid)?h.setItemState(f,"inactive",!1):h.setItemState(f,"active",!1)})}var De=function(){E({}),e.onClosePathsFinder()},le=function(_){ce(!_)},Te=function(){if(e.selectedNodes.length<=1)return null;var _=e.selectedNodes[0].id;return e.selectedNodes.map(function(ee){var T=_+"_"+ee.id;return(0,t.jsxs)("li",{className:C[T],onMouseEnter:function(){xe(x[T])},onMouseLeave:function(){be(x[T])},children:[(0,t.jsx)("span",{children:ee.data.name}),"\xA0",(0,t.jsx)("span",{children:C[T]==="bfs"?"BFS":"DFS"})]},T)})},Me=function(_,ee,T){ee(),r(_[0]),u(T)},Ce=function(_){_(),r("")},Be=function(_){return{filterDropdown:function(T){var v=T.setSelectedKeys,f=T.selectedKeys,k=T.confirm,V=T.clearFilters,U=T.close;return(0,t.jsxs)("div",{style:{padding:8},onKeyDown:function(ie){return ie.stopPropagation()},children:[(0,t.jsx)(Bt.Z,{ref:Z,placeholder:"Search ".concat(_),value:f[0],onChange:function(ie){return v(ie.target.value?[ie.target.value]:[])},onPressEnter:function(){return Me(f,k,_)},style:{marginBottom:8,display:"block"}}),(0,t.jsxs)(Xt.Z,{children:[(0,t.jsx)(W.Z,{type:"primary",onClick:function(){return Me(f,k,_)},icon:(0,t.jsx)(Fn.Z,{}),size:"small",style:{width:90},children:"Search"}),(0,t.jsx)(W.Z,{onClick:function(){return V&&Ce(V)},size:"small",style:{width:90},children:"Reset"}),(0,t.jsx)(W.Z,{type:"link",size:"small",onClick:function(){k({closeDropdown:!1}),r(f[0]),u(_)},children:"Filter"}),(0,t.jsx)(W.Z,{type:"link",size:"small",onClick:function(){U()},children:"close"})]})]})},filterIcon:function(T){return(0,t.jsx)(Fn.Z,{style:{color:T?"#1890ff":void 0}})},onFilter:function(T,v){return v[_].toString().toLowerCase().includes(T.toLowerCase())},onFilterDropdownOpenChange:function(T){T&&setTimeout(function(){var v;return(v=Z.current)===null||v===void 0?void 0:v.select()},100)},render:function(T){return c===_?(0,t.jsx)(dr(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[o],autoEscape:!0,textToHighlight:T?T.toString():""}):T}}},F=[(0,m.Z)({title:"Path",key:"path",align:"center",dataIndex:"path",width:300},Be("path")),{title:"Num of Steps",dataIndex:"nsteps",key:"nsteps",align:"center",width:150,sorter:function(_,ee){return _.nsteps-ee.nsteps},sortDirections:["descend","ascend"]},{title:"Action",key:"action",align:"center",fixed:"right",width:150,render:function(_,ee,T){return(0,t.jsxs)(Xt.Z,{children:[(0,t.jsx)(W.Z,{size:"small",type:"link",disabled:ee.path===I,onClick:function(f){var k=ee.key,V=ee.index,U=[x[k][V]];xe(U),O(ee.path)},children:"Show"}),(0,t.jsx)(W.Z,{size:"small",type:"link",onClick:function(f){Jt.Z.open({type:"info",message:"Explain the Current Path",description:"Not implemented yet (We will try to train a LLM with knowledge graph to explain why the path would be believable)",duration:10})},children:"Explain"})]})}}];return(0,t.jsxs)("div",{className:"show-paths-panel",children:[(0,t.jsxs)("div",{className:"title",children:[(0,t.jsx)("h3",{children:"Paths Finder"}),(0,t.jsxs)("span",{children:[(0,t.jsx)(cr.Z,{onClick:function(){return le($)}}),(0,t.jsx)(ur.Z,{onClick:De})]})]}),(0,t.jsx)("ul",{className:"status-ul body",children:Te()}),$?(0,t.jsx)(Lt,{title:"Path Table",onClose:function(){O(null),ce(!1)},width:"600px",children:(0,t.jsx)(Ye.Z,{className:"path-table",rowKey:function(_){return"".concat(_.index,"-").concat(_.path)},columns:F,dataSource:B,ref:b,scroll:{y:200},size:"small",pagination:{simple:!0,defaultPageSize:1e3,position:["topLeft"],showTotal:function(_){return"Total ".concat(_," items")}}})}):null]})},pr=vr,gr=d(18045),mr=Ot.Z.MiniMap,yr=Ot.Z.SnapLine,An=Ot.Z.Tooltip,zn=Ot.Z.Legend,xr=Ue.Z.ZoomCanvas,Zr=Ue.Z.ActivateRelations,Sr=Ue.Z.ClickSelect,br=Ue.Z.Hoverable,Cr=Ue.Z.FitView,jr=Ue.Z.DragNodeWithForce,Nr=Ue.Z.DragNode,wr=Ue.Z.LassoSelect,kr=Ue.Z.BrushSelect,ot=Rt.Z.Menu,Pr={line:{stroke:"lightgreen",lineWidth:1}},Er=function(e){var n=(0,l.useContext)(Ie.Z),a=n.graph,o=n.apis,r=e.item,i=e.chatbotVisible,s=e.onExplainRelationship,c=(0,l.useState)(!1),u=(0,S.Z)(c,2),Z=u[0],b=u[1],y=(0,l.useState)(void 0),h=(0,S.Z)(y,2),N=h[0],p=h[1],x=(0,l.useState)(void 0),E=(0,S.Z)(x,2),j=E[0],M=E[1],C=(0,l.useState)(void 0),L=(0,S.Z)(C,2),J=L[0],D=L[1];(0,l.useEffect)(function(){if(r){var K=r.getModel(),H=a.findById(K.source).getModel(),$=a.findById(K.target).getModel();H&&$&&K&&(p(H),M($),D(K),b(!0))}else b(!1),p(void 0),M(void 0),D(void 0)},[]);var I=[{key:"show-edge-details",icon:(0,t.jsx)(yn.Z,{}),label:"Show Edge Details"},{key:"explain-relationship",icon:(0,t.jsx)(Aa.Z,{}),label:"Explain Relationship (Experimental)"},{key:"analyze-with-clinical-data",icon:(0,t.jsx)(xn.Z,{}),label:"Analyze with Clinical Data",children:[{key:"barchart",icon:(0,t.jsx)(xn.Z,{}),label:"Bar Chart"},{key:"boxchart",icon:(0,t.jsx)(za.Z,{}),label:"Box Plot"},{key:"heatmap",icon:(0,t.jsx)(Zn.Z,{}),label:"Heatmap"},{key:"scatterchart",icon:(0,t.jsx)(Yt.Z,{}),label:"Scatter Chart"}]},{key:"analyze-with-omics-data",icon:(0,t.jsx)(Ba.Z,{}),label:"Analyze with Omics Data",children:[{key:"heatmap-omics",icon:(0,t.jsx)(Zn.Z,{}),label:"Heatmap"},{key:"scatterchart-omics",icon:(0,t.jsx)(Yt.Z,{}),label:"Scatter Chart"}]}];i&&I.push({key:"ask-question",icon:(0,t.jsx)(Sn.Z,{}),label:"Ask Chatbot",children:[{key:"what-is-the-relationship",icon:(0,t.jsx)(Va.Z,{}),label:"What is the relationship between the two nodes?"}]});var O=function(H){e.onChange&&N&&j&&J&&a&&o?(e.onChange(H,N,j,J,a,o),b(!1)):Y.ZP.warn("Cannot catch the changes.")};return Z?(0,t.jsx)(Ze.Z,{items:I,onClick:O}):null},Ir=function(e){var n=(0,l.useContext)(Ie.Z),a=n.graph,o=n.apis,r=e.item,i=e.chatbotVisible,s=(0,l.useState)(!1),c=(0,S.Z)(s,2),u=c[0],Z=c[1];console.log("NodeMenu",e.item);var b=(0,l.useState)(void 0),y=(0,S.Z)(b,2),h=y[0],N=y[1];(0,l.useEffect)(function(){if(r&&r._cfg){var E=r.getModel();N(E),Z(!0)}else Z(!1),N(void 0)},[]);var p=[{key:"show-node-details",icon:(0,t.jsx)(yn.Z,{}),label:"Show Node Details"},{key:"expand-one-level",icon:(0,t.jsx)(Ua.Z,{}),label:"Expand One Level"},{key:"expand-selected-nodes",icon:(0,t.jsx)(tt.Z,{}),label:"Expand Selected Nodes"},{key:"reverse-selected-nodes",icon:(0,t.jsx)(Wa.Z,{}),label:"Reverse Selected Nodes"},{key:"predict-relationships",icon:(0,t.jsx)(Ka.Z,{}),label:"Predict Relationships"},{key:"visulize-similarities",icon:(0,t.jsx)(Yt.Z,{}),label:"Visualize Similarities"},{key:"expand-all-paths",icon:(0,t.jsx)(Ft.Z,{}),label:"Expand Paths (Within 3 Steps)",children:[{key:"expand-all-paths-1",icon:(0,t.jsx)(Ft.Z,{}),label:"Within 1 Step"},{key:"expand-all-paths-2",icon:(0,t.jsx)(Ft.Z,{}),label:"Within 2 Step"},{key:"expand-all-paths-3",icon:(0,t.jsx)(Ft.Z,{}),label:"Within 3 Step"}]},{key:"delete-nodes",icon:(0,t.jsx)(Ha.Z,{}),label:"Delete Selected Node(s)",danger:!0}];i&&p.push({key:"ask-question",icon:(0,t.jsx)(Sn.Z,{}),label:"Ask Chatbot",children:[{key:"what-is-the-node",icon:(0,t.jsx)(bn.Z,{}),label:"What is the node?"}]});var x=function(j){j.key==="reverse-selected-nodes"?(a.getNodes().forEach(function(M){M.hasState("selected")?a.setItemState(M,"selected",!1):a.setItemState(M,"selected",!0)}),h&&a.setItemState(h.id,"selected",!1),Z(!1)):e.onChange&&h&&a&&o?(e.onChange(j,h,a,o),Z(!1)):Y.ZP.warn("Cannot catch the changes.")};return u?(0,t.jsx)(Ze.Z,{items:p,onClick:x}):null},Tr=function(e){var n=(0,l.useContext)(Ie.Z),a=n.graph,o=n.contextmenu,r=n.apis,i=o.canvas,s=function(){if(a.getNodes().length==0){Y.ZP.warn("No data to download");return}a.downloadFullImage("canvas","image/png",{backgroundColor:"#fff",padding:10}),i.handleClose()},c=function(){var h=Rn(a);if(h.data.nodes.length==0){Y.ZP.warn("No data to download");return}var N={payload:h,name:"shared-graph",description:"Shared graph"},p=new Blob([JSON.stringify(N)],{type:"application/json"}),x=document.createElement("a");x.href=URL.createObjectURL(p),x.download="graph.json",x.click()},u=function(){e.onCanvasClick&&e.onCanvasClick({key:"auto-connect",name:"AutoConnect"},a,r)},Z=function(){e.onClearGraph?(e.onClearGraph(),Y.ZP.info("Clear canvas successfully")):Y.ZP.warn("Cannot clear canvas"),i.handleClose()},b=function(){e.handleOpenFishEye&&e.handleOpenFishEye()};return(0,t.jsxs)(ot,{bindType:"canvas",children:[(0,t.jsx)(ot.Item,{onClick:u,children:(0,t.jsxs)(W.Z,{type:"text",children:[(0,t.jsx)(At.Z,{})," Auto Connect Graph"]})}),(0,t.jsx)(ot.Item,{onClick:b,children:(0,t.jsxs)(W.Z,{type:"text",children:[(0,t.jsx)(bn.Z,{})," Enable FishEye"]})}),(0,t.jsx)(ot.Item,{onClick:c,children:(0,t.jsxs)(W.Z,{type:"text",children:[(0,t.jsx)($a.Z,{})," Download Graph Data"]})}),(0,t.jsx)(ot.Item,{onClick:s,children:(0,t.jsxs)(W.Z,{type:"text",children:[(0,t.jsx)(nt.Z,{})," Save As Image"]})}),(0,t.jsx)(ot.Item,{onClick:Z,children:(0,t.jsxs)(W.Z,{type:"text",danger:!0,children:[(0,t.jsx)(Qa.Z,{}),"Clear Canvas"]})})]})},Bn=function(e){var n=e.bindType,a=e.disabled,o=(0,l.useContext)(Ie.Z),r=o.graph,i=(0,l.useState)(!1),s=(0,S.Z)(i,2),c=s[0],u=s[1];return(0,t.jsx)(br,{bindType:n,disabled:c||a})},Dr=function(e){var n=e.visible,a=(0,l.useContext)(Ie.Z).graph;return(0,l.useEffect)(function(){a.getNodes().forEach(function(o){a.updateItem(o,{style:{label:{visible:n}}})})},[n]),null},Mr=function(e){var n=e.visible,a=(0,l.useContext)(Ie.Z).graph;return(0,l.useEffect)(function(){a.getEdges().forEach(function(o){a.updateItem(o,{style:{label:{visible:n}}})})},[n]),null},Gr=function(e){if(e.selectedNode){var n=(0,l.useContext)(Ie.Z),a=n.graph,o=a.getNodes(),r=a.getEdges();e.mode=="activate"?(o.forEach(function(i){a.setItemState(i,"inactive",!1),a.setItemState(i,"active",!1)}),o.forEach(function(i){var s=i.getModel();e.selectedNode&&e.selectedNode!==s.id?(console.log("UnSelected Node: ",e.selectedNode,s.id),a.setItemState(i,"inactive",!0)):(console.log("Selected Node: ",e.selectedNode,s.id),a.setItemState(i,"active",!0))})):a.focusItem(e.selectedNode,!0)}return null},Vn=function(e){var n=(0,l.useContext)(Ie.Z),a=n.graph,o=n.apis;return(0,l.useEffect)(function(){e.queriedId&&e.mode=="focus"&&o.focusNodeById(e.queriedId);var r=function(s){var c=s.item,u=c.getModel();e.mode=="focus"&&o.focusNodeById(u.id),e.onClickNode&&e.onClickNode(c.getModel())};return a.on("node:click",r),function(){a.off("node:click",r)}},[]),null},Or=function(e){var n=(0,l.useContext)(Ie.Z),a=n.graph,o=n.apis;return(0,l.useEffect)(function(){var r=function(s){if(e.onClick){var c=s.item,u=c.getModel();e.onClick(u.id,u)}};return a.on("node:click",r),function(){a.off("node:click",r)}},[]),null},Lr=function(e){var n=(0,l.useContext)(Ie.Z),a=n.graph,o=n.apis;return(0,l.useEffect)(function(){var r=function(s){if(e.onClick){var c=s.item,u=c.getModel(),Z=a.findById(u.source).getModel(),b=a.findById(u.target).getModel();e.onClick(u.relid,Z,b,u)}};return a.on("edge:click",r),function(){a.off("edge:click",r)}},[]),null},Rr=function(){var e=(0,l.useContext)(Ie.Z),n=e.graph,a=e.apis,o=(0,l.useState)(!1),r=(0,S.Z)(o,2),i=r[0],s=r[1],c=(0,l.useState)([]),u=(0,S.Z)(c,2),Z=u[0],b=u[1],y=function(p){console.log("handleNodeSelectorChange: ",p),p&&a.focusNodeById(p)},h=function(p){if(console.log("handleNodeSearch: ",p),s(!0),p){var x=[];n.getNodes().forEach(function(E){var j=E.getModel();console.log("handleNodeSearch: ",j),(j.label&&j.label.toLowerCase().includes(p.toLowerCase())||j.data.name&&j.data.name.toLowerCase().includes(p.toLowerCase()))&&x.push({label:"".concat(j.id," | ").concat(j.data.name),value:j.id})}),b(x),s(!1)}else b([]),s(!1)};return(0,t.jsx)(w.Z,{className:"node-searcher",showSearch:!0,allowClear:!0,loading:i,defaultActiveFirstOption:!1,showArrow:!0,placement:"topRight",placeholder:"Search nodes",onSearch:h,onChange:y,options:Z,filterOption:!1,notFoundContent:(0,t.jsx)(ke.Z,{description:i?"Searching...":Z!==void 0?"Not Found":"Enter your interested node ..."})})},Fr={autoPin:!1,nodeLabelVisible:!0,edgeLabelVisible:!0,nodeTooltipEnabled:!0,edgeTooltipEnabled:!1,interactiveMode:"select-nodes",selectionMode:"brush-select",miniMapEnabled:!0,snapLineEnabled:!0,infoPanelEnabled:!0},Ar=function(e){var n,a,o=e.data,r=e.style,i=e.onNodeMenuClick,s=e.onEdgeMenuClick,c=e.selectedNode,u=e.onCanvasMenuClick,Z=(0,l.useState)(!1),b=(0,S.Z)(Z,2),y=b[0],h=b[1],N=(0,l.useState)(!1),p=(0,S.Z)(N,2),x=p[0],E=p[1],j=(0,l.useState)({}),M=(0,S.Z)(j,2),C=M[0],L=M[1],J=(0,l.useState)(null),D=(0,S.Z)(J,2),I=D[0],O=D[1],K=(0,l.useState)(null),H=(0,S.Z)(K,2),$=H[0],ce=H[1],Se=(0,l.useState)([]),pe=(0,S.Z)(Se,2),B=pe[0],Q=pe[1],xe=(0,l.useState)({}),ye=(0,S.Z)(xe,2),be=ye[0],De=ye[1],le=l.useRef(null),Te=(0,t.jsx)("p",{style:{width:"400px"},children:'If you would like to select multiple nodes, please set the interactive mode to "select-nodes". Then press the "Shift" key and click the nodes you want to select.'});(0,l.useEffect)(function(){T(),le&&le.current&&le.current.graph&&(le.current.graph.on("edge:contextmenu",function(v){O(v.item)}),le.current.graph.on("node:contextmenu",function(v){ce(v.item)}))},[]),(0,l.useEffect)(function(){Q([])},[C.interactiveMode]),(0,l.useEffect)(function(){le.current&&le.current.graph&&(console.log("Updating layout: ",e.layout),le.current.graph.updateLayout(e.layout),le.current.graph.refreshPositions(),le.current.graph.fitView())},[e.layout]),(0,l.useEffect)(function(){var v=new Map,f=(0,te.Z)(o.nodes),k;try{for(f.s();!(k=f.n()).done;){var V=k.value;v.set(V.id,[])}}catch(he){f.e(he)}finally{f.f()}var U=(0,te.Z)(o.edges),ae;try{for(U.s();!(ae=U.n()).done;){var ie=ae.value;v.get(ie.source).push(ie.target),v.get(ie.target).push(ie.source)}}catch(he){U.e(he)}finally{U.f()}De(v)},[o]);var Me=function(){h(!0)},Ce=function(){h(!1)},Be=function(f){Q(function(k){return[].concat((0,me.Z)(k),[f])})},F=function(){Q([])},q=function(f){var k=f.data,V=f.style;console.log("HoverText: ",k);var U=wn(k,["comboId","degree","depth","layoutOrder","x","y","type","category"]),ae=Object.keys(U).map(function(ie){return U[ie]?(0,t.jsx)(G.Z.Item,{label:He.Z.titleCase(ie),style:{height:"50px",overflowY:"scroll"},children:U[ie]},ie):null});return ae.length>0?(0,t.jsx)(G.Z,{size:"small",column:1,title:null,bordered:!0,style:V,children:ae}):(0,t.jsx)("span",{style:V,children:"No Properties"})},_={enabledStack:!0,filterCenter:!0},ee=function(f,k){console.log(f,k)},T=function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"graphin-settings",k=JSON.parse(localStorage.getItem(f)||"{}");Object.keys(k).length===0?L(Fr):(L(k),Y.ZP.success("Settings loaded"))};return o&&(0,t.jsxs)(rt.ZP,{ref:le,layoutCache:!0,options:_,data:o,layout:e.layout,style:r,children:[(0,t.jsx)(Cr,{}),(0,t.jsx)(jr,{autoPin:C.autoPin}),(0,t.jsx)(Nr,{}),(0,t.jsx)(xr,{}),C.selectionMode=="lasso-select"?(0,t.jsx)(wr,{}):null,C.selectionMode=="brush-select"?(0,t.jsx)(kr,{}):null,(0,t.jsx)(Dr,{visible:C.nodeLabelVisible}),(0,t.jsx)(Mr,{visible:C.edgeLabelVisible}),(0,t.jsx)(Fa.Z,{options:{},visible:y,handleEscListener:Ce}),(0,t.jsx)(Gr,{selectedNode:c,mode:e.highlightMode}),C.interactiveMode=="show-paths"?(0,t.jsx)(Bn,{bindType:"node"}):null,C.interactiveMode=="show-paths"?(0,t.jsx)(Bn,{bindType:"edge"}):null,C.interactiveMode=="show-paths"?(0,t.jsx)(Zr,{}):null,(0,t.jsx)(Rt.Z,{style:{width:"160px"},children:(0,t.jsx)(Ir,{chatbotVisible:e.chatbotVisible,item:$,onChange:function(f,k,V,U){ce(null),i&&i(f,k,V,U)}})}),(0,t.jsx)(Rt.Z,{style:{width:"160px"},bindType:"canvas",children:(0,t.jsx)(Tr,{handleOpenFishEye:Me,onCanvasClick:function(f,k,V){ce(null),O(null),u&&u(f,k,V)},onClearGraph:e.onClearGraph})}),(0,t.jsx)(Rt.Z,{style:{width:"160px"},bindType:"edge",children:(0,t.jsx)(Er,{item:I,chatbotVisible:e.chatbotVisible,onChange:function(f,k,V,U,ae,ie){O(null),f.key=="explain-relationship"&&(O(U),E(!0)),s&&s(f,k,V,U,ae,ie)}})}),(0,t.jsx)(zn,{bindType:"node",sortKey:"nlabel",children:function(f){return console.log("renderProps",f),(0,t.jsx)(zn.Node,(0,m.Z)((0,m.Z)({},f),{},{onChange:ee}))}}),e.toolbarVisible?(0,t.jsx)(Lt,{title:"Settings",width:"220px",top:"100px",right:"30px",help:Te,children:(0,t.jsxs)(Pe.Z,{style:{position:"relative",marginBottom:"0px",opacity:.8},direction:"horizontal",children:[(0,t.jsx)(Pe.Z.Item,{children:(0,t.jsx)(w.Z,{style:{width:"100%"},allowClear:!0,defaultValue:e.layout.type,onChange:function(f){if(f=="auto")gr.n.predict(o).then(function(U){console.log("Predicted layout: ",U);var ae=gt.find(function(ie){return ie.type===U.predictLayout});ae?(Y.ZP.info("Predicted layout: ".concat(U.predictLayout)),e.changeLayout&&e.changeLayout(ae)):Y.ZP.error("Predicted layout is ".concat(U.predictLayout,", but it is not supported currently."))}).catch(function(U){console.log(U),Y.ZP.error("Failed to predict layout: ".concat(U.message))});else if(f=="graphin-force"){Y.ZP.warn("The layout '".concat(f,"' may not work well with the device which doesn't support GPU."));var k=gt.find(function(U){return U.type===f});e.changeLayout&&e.changeLayout(k)}else{var V=void 0;f?V=gt.find(function(U){return U.type===f}):V=gt.find(function(U){return U.type==="force"}),e.changeLayout&&V&&e.changeLayout(V)}},placeholder:"Select a layout",children:gt.map(function(v){var f=v.type;return(0,t.jsxs)(w.Z.Option,{value:f,children:[(0,t.jsx)(At.Z,{}),"\xA0",f]},f)})})}),(0,t.jsx)(Pe.Z.Item,{children:(0,t.jsx)(w.Z,{style:{width:"100%"},allowClear:!0,value:C.interactiveMode,onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{interactiveMode:f}))},placeholder:"Select a interactive mode",children:["show-details","select-nodes","show-paths"].map(function(v){return(0,t.jsxs)(w.Z.Option,{value:v,children:[(0,t.jsx)(At.Z,{}),"\xA0",He.Z.titleCase(v)]},v)})})}),(0,t.jsx)(Pe.Z.Item,{children:(0,t.jsx)(w.Z,{style:{width:"100%"},allowClear:!0,defaultValue:"brush-select",disabled:C.interactiveMode!=="select-nodes",onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{selectionMode:f}))},placeholder:"Select a selection mode",children:["brush-select","lasso-select"].map(function(v){return(0,t.jsxs)(w.Z.Option,{value:v,children:[(0,t.jsx)(At.Z,{}),"\xA0",He.Z.titleCase(v)]},v)})})}),(0,t.jsxs)(Pe.Z.Item,{children:[(0,t.jsx)(Ee.Z,{onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{autoPin:f}))},checked:C.autoPin,disabled:!0}),"Auto Pin"]}),(0,t.jsxs)(Pe.Z.Item,{children:[(0,t.jsx)(Ee.Z,{onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{nodeLabelVisible:f}))},checked:C.nodeLabelVisible}),"Node Label"]}),(0,t.jsxs)(Pe.Z.Item,{children:[(0,t.jsx)(Ee.Z,{onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{edgeLabelVisible:f}))},checked:C.edgeLabelVisible}),"Edge Label"]}),(0,t.jsxs)(Pe.Z.Item,{children:[(0,t.jsx)(Ee.Z,{onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{nodeTooltipEnabled:f}))},checked:C.nodeTooltipEnabled}),"Node Tooltip"]}),(0,t.jsxs)(Pe.Z.Item,{children:[(0,t.jsx)(Ee.Z,{onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{edgeTooltipEnabled:f}))},checked:C.edgeTooltipEnabled}),"Edge Tooltip"]}),(0,t.jsxs)(Pe.Z.Item,{children:[(0,t.jsx)(Ee.Z,{onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{miniMapEnabled:f}))},checked:C.miniMapEnabled}),"MiniMap"]}),(0,t.jsxs)(Pe.Z.Item,{children:[(0,t.jsx)(Ee.Z,{onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{snapLineEnabled:f}))},checked:C.snapLineEnabled}),"SnapLine"]}),(0,t.jsxs)(Pe.Z.Item,{children:[(0,t.jsx)(Ee.Z,{onChange:function(f){L((0,m.Z)((0,m.Z)({},C),{},{infoPanelEnabled:f}))},checked:C.infoPanelEnabled}),"Info Panel"]}),(0,t.jsx)(Pe.Z.Item,{children:(0,t.jsx)(W.Z,{type:"primary",size:"small",style:{width:"100%"},onClick:function(){localStorage.setItem("graphin-settings",JSON.stringify(C)),Y.ZP.success("Settings saved")},children:"Save Settings"})}),(0,t.jsx)(Pe.Z.Item,{children:(0,t.jsx)(W.Z,{danger:!0,size:"small",style:{width:"100%"},onClick:function(){T()},children:"Load Settings"})})]})}):null,(0,t.jsx)(Rr,{}),C.interactiveMode=="show-paths"?(0,t.jsx)(Vn,{queriedId:e.queriedId,onClickNode:Be,mode:"focus"}):null,C.interactiveMode=="select-nodes"?(0,t.jsx)(Vn,{queriedId:e.queriedId,onClickNode:Be,mode:"select"}):null,C.interactiveMode=="show-paths"?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(pr,{selectedNodes:B,nodes:o.nodes,edges:o.edges,onClosePathsFinder:F,adjacencyList:be,algorithm:o.edges.length>500?"bfs":"dfs"})}):null,I&&x?(0,t.jsxs)(Lt,{onClose:function(){E(!1)},children:["TODO: generate explanations for the current edge",(0,t.jsx)("br",{}),"1. Get the current edge, the source node and target node",(0,t.jsx)("br",{}),"2. Send the source node and target node to the backend and get the prompt (markdown format) which contains the prompt and api codes for retrieving context information",(0,t.jsx)("br",{}),"3. Send the markdown to the backend and get the filled markdown",(0,t.jsx)("br",{}),"4. Send the filled markdown to LLM and generate explanations by using `rethinking with retrieval` method",(0,t.jsx)("br",{}),"5. Show the filled markdown in the explanation panel",(0,t.jsx)("br",{})]}):null,C.interactiveMode=="select-nodes"?(0,t.jsx)(Sr,{multiple:!0,trigger:"shift"}):null,C.interactiveMode=="show-details"?(0,t.jsx)(Or,{onClick:e.onClickNode}):null,C.interactiveMode=="show-details"?(0,t.jsx)(Lr,{onClick:e.onClickEdge}):null,C.nodeTooltipEnabled?(0,t.jsx)(An,{bindType:"node",hasArrow:!0,placement:"bottom",style:{opacity:.9},children:function(f){if(f.model){var k=f.model;return(0,t.jsx)(q,{data:k,style:{padding:"10px",width:"fit-content",maxWidth:"400px"}})}return null}}):null,C.edgeTooltipEnabled?(0,t.jsx)(An,{bindType:"edge",hasArrow:!0,placement:"bottom",style:{opacity:.9},children:function(f){if(f.model){var k=f.model;return(0,t.jsx)(q,{data:k,style:{padding:"10px",width:"fit-content"}})}return null}}):null,C.miniMapEnabled?(0,t.jsx)(mr,{}):null,C.snapLineEnabled?(0,t.jsx)(yr,{options:Pr,visible:!0}):null,C.infoPanelEnabled?(0,t.jsx)(_a,{data:e.statistics,style:{position:"absolute",top:"0px",left:"0px",zIndex:1}}):null,(0,t.jsx)(gn.Provider,{value:{graph:(n=le.current)===null||n===void 0?void 0:n.graph,apis:(a=le.current)===null||a===void 0?void 0:a.apis,selectedNodes:B},children:e.children?e.children:null})]})},zr=Ar,it=d(39428),qt=d(3182),Vt,Br=function(e){var n=(0,l.useState)([]),a=(0,S.Z)(n,2),o=a[0],r=a[1],i=(0,l.useState)(!1),s=(0,S.Z)(i,2),c=s[0],u=s[1],Z=(0,l.useState)("Search Gene nodes ..."),b=(0,S.Z)(Z,2),y=b[0],h=b[1],N=(0,l.useState)(void 0),p=(0,S.Z)(N,2),x=p[0],E=p[1],j=(0,l.useState)("Gene"),M=(0,S.Z)(j,2),C=M[0],L=M[1],J=function(){var K=(0,qt.Z)((0,it.Z)().mark(function H($,ce){var Se;return(0,it.Z)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:Vt&&(clearTimeout(Vt),Vt=null),Se=function(){u(!0),e.getLabels({query_str:kn({id:ce,name:ce},{},{}),label_type:$}).then(function(xe){var ye=xe.data,be=ye.map(function(le){return{value:le.id,text:"".concat(le.id," | ").concat(le.name)}});console.log("getLabels results: ",be);var De=be.map(function(le){return{label:le.text,value:le.value}});u(!1),E(De)}).catch(function(xe){console.log("requestNodes Error: ",xe),E([]),u(!1)})},Vt=setTimeout(Se,300);case 3:case"end":return B.stop()}},H)}));return function($,ce){return K.apply(this,arguments)}}(),D=function(H){L(H),E(void 0),h("Search ".concat(H," nodes ..."))},I=function(H){H?J(C,H):E(void 0)},O=function(H){if(console.log("Handle Change: ",H),H){var $;($=e.onChange)===null||$===void 0||$.call(e,C,H)}else{var ce;(ce=e.onChange)===null||ce===void 0||ce.call(e,C,void 0)}};return(0,l.useEffect)(function(){e.getNodeTypes().then(function(K){console.log("Get types of nodes: ",K);var H=[];K.node_types?(K.node_types.forEach(function($){H.push({order:0,label:$,value:$})}),r(H)):r([])}).catch(function(K){console.log("Get types of nodes error: ",K),r([])})},[]),(0,t.jsxs)(X.Z,{className:"query-builder",children:[(0,t.jsx)(w.Z,{value:C,style:{width:"auto",minWidth:"100px"},options:o,onSelect:D}),(0,t.jsx)(w.Z,{showSearch:!0,allowClear:!0,loading:c,defaultActiveFirstOption:!1,showArrow:!0,placeholder:y,onSearch:I,onChange:O,options:x,filterOption:!1,notFoundContent:(0,t.jsx)(ke.Z,{description:c?"Searching...":x!==void 0?"Not Found":"Enter your interested ".concat(C," ...")})}),(0,t.jsx)(W.Z,{onClick:e.onAdvancedSearch,children:"Advanced"})]})},Vr=Br,ol=d(58996),Ur=d(77933),Wr=d(91966),Un=d.n(Wr),Kr=["leftColumns","rightColumns"],Hr=[{node_id:"MESH:D002289",node_type:"Disease"},{node_id:"MESH:D015673",node_type:"Disease"}],$r=function(){var e="node_id,node_type",n=Hr.map(function(i){return"".concat(i.node_id,",").concat(i.node_type)});n.unshift(e);var a="data:text/csv;charset=utf-8,"+n.join(`
`),o=encodeURI(a),r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download","example.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r)},Qr=[{dataIndex:"node_id",title:"ID",align:"center"},{dataIndex:"node_type",title:"Type",align:"center"},{dataIndex:"matched_id",title:"Matched ID",align:"center"},{dataIndex:"matched_name",title:"Matched Name",align:"center"},{dataIndex:"disabled",title:"Status",align:"center",render:function(e){return(0,t.jsx)(Ae.Z,{children:e?"Not Matched":"Matched"})}}],Yr=[{dataIndex:"node_id",title:"Raw ID",align:"center"},{dataIndex:"matched_id",title:"Matched ID",align:"center"}],_r=function(e){var n=e.leftColumns,a=e.rightColumns,o=(0,Cn.Z)(e,Kr);return(0,t.jsx)(Ur.Z,(0,m.Z)((0,m.Z)({},o),{},{children:function(i){var s=i.direction,c=i.filteredItems,u=i.onItemSelectAll,Z=i.onItemSelect,b=i.selectedKeys,y=i.disabled,h=s==="left"?n:a,N={getCheckboxProps:function(x){return{disabled:y||x.disabled}},onSelectAll:function(x,E){var j=E.filter(function(C){return!C.disabled}).map(function(C){var L=C.key;return L}),M=x?Un()(j,b):Un()(b,j);u(M,x)},onSelect:function(x,E){var j=x.key;Z(j,E)},selectedRowKeys:b};return(0,t.jsx)(Ye.Z,{rowSelection:N,columns:h,dataSource:c,size:"small",style:{pointerEvents:y?"none":void 0},onRow:function(x){var E=x.key,j=x.disabled;return{onClick:function(){j||y||Z(E,!b.includes(E))}}}})}}))},Jr=function(e){var n=(0,l.useState)([]),a=(0,S.Z)(n,2),o=a[0],r=a[1],i=function(){if(o.length===0){Y.ZP.warn("Please select at least one node from the left table.");return}else{var u;(u=e.onOk)===null||u===void 0||u.call(e,{node_ids:o,merge_mode:"append",mode:"batchIds"})}},s=function(u){r(u),console.log("targetKeys: ",u)};return(0,t.jsxs)(X.Z,{className:"transfer-table",children:[(0,t.jsx)(_r,{dataSource:e.dataSource,targetKeys:o,showSearch:!0,onChange:s,filterOption:function(u,Z){return Z.node_id.indexOf(u)!==-1||Z.node_type.indexOf(u)!==-1},leftColumns:Qr,rightColumns:Yr}),(0,t.jsxs)(X.Z,{className:"button-group",children:[(0,t.jsx)(W.Z,{type:"link",onClick:function(){$r()},children:"Download Example File"}),(0,t.jsx)(W.Z,{onClick:e.onCancel,children:"Cancel"}),(0,t.jsx)(W.Z,{type:"primary",onClick:i,children:"Search"})]})]})},Xr=Jr,il=d(43185),Wn=d(11324),Kn=d(84391),qr=d(57460),eo=d.n(qr),to=function(e){var n=(0,l.useState)([]),a=(0,S.Z)(n,2),o=a[0],r=a[1],i=function(u){var Z=u.reduce(function(h,N){var p=N.node_type,x=N.node_id;return h[p]?h[p].push(x):h[p]=[x],h},{}),b=Object.keys(Z);console.log("UploadNode fetch: ",Z,b);var y=b.map(function(h){return e.getLabels({query_str:"{:select [:*] :where [:in :id ".concat(JSON.stringify(Z[h]),"]}"),label_type:h})});return Promise.all(y)};(0,l.useEffect)(function(){e.onUpload(o)},[o]);var s={name:"file",action:"/api/upload",showUploadList:!1,beforeUpload:function(u){var Z=new FileReader;return Z.readAsText(u),Z.onload=function(){eo().parse(Z.result,{complete:function(y){var h=[];y.data.length>=100?(Y.ZP.warn("The number of nodes should be less than 100, we will only use the first 100 nodes."),h=y.data.slice(0,100)):h=y.data;var N=h.map(function(L,J){return J===0?L.map(function(D){return(0,Je.Z)({},D,null)}):L.reduce(function(D,I,O){return D[h[0][O]]=I,D},{})});Y.ZP.success("Successfully parsed CSV data");var p=N.filter(function(L){return L.node_id&&L.node_type});console.log("Parsed CSV data:",N,p);var x=[],E=(0,te.Z)(p),j;try{for(E.s();!(j=E.n()).done;){var M=j.value;x.push({key:M.node_id,node_id:M.node_id,node_type:M.node_type})}}catch(L){E.e(L)}finally{E.f()}var C=(0,se.uniqBy)(x,function(L){return"".concat(L.node_id,"-").concat(L.node_type)});Jt.Z.info({message:"Found duplicated nodes",description:"The number of nodes is ".concat(x.length,", the number of unique nodes is ").concat(C.length)}),console.log("selectedData: ",x,C),x=C,x.length>0?i(x).then(function(L){var J=(0,se.flatten)(L.map(function(I,O){return I.data})),D=x.map(function(I,O){var K=J.find(function(H){return"".concat(H.id)===I.node_id});return K?{key:I.node_id,node_id:I.node_id,node_type:I.node_type,matched_id:K.id,matched_name:K.name,disabled:!1}:{key:I.node_id,node_id:I.node_id,node_type:I.node_type,matched_id:"",matched_name:"",disabled:!0}});r(D)}).catch(function(L){console.log(L)}):Y.ZP.error("No satisfied data in the uploaded file")},error:function(y){Y.ZP.error("Failed to parse CSV data")}})},Z.onerror=function(b){Y.ZP.error("Failed to read file")},!1}};return(0,t.jsx)(Wn.Z,(0,m.Z)((0,m.Z)({},s),{},{children:(0,t.jsx)(W.Z,{icon:(0,t.jsx)(Kn.Z,{}),children:"Upload"})}))},no=to,ll=d(77883),Hn=d(49747),sl=d(88983),mt=d(47933),dl=d(9715),fe=d(55843),Ut,ao=[{label:"Replace",value:"replace"},{label:"Append",value:"append"},{label:"Subtract",value:"subtract"}],ro=[{label:"Query n nodes for each node",value:"each"},{label:"Query n nodes for all nodes",value:"total"}],oo=[{label:"1 Step",value:1},{label:"2 Steps",value:2},{label:"3 Steps",value:3},{label:"4 Steps",value:4},{label:"5 Steps",value:5}],io=function(e){var n,a,o=fe.Z.useForm(),r=(0,S.Z)(o,1),i=r[0],s=fe.Z.useWatch("mode",i),c=fe.Z.useWatch("node_id",i),u=fe.Z.useWatch("node_type",i),Z=fe.Z.useWatch("enable_prediction",i),b=fe.Z.useWatch("nsteps",i),y=fe.Z.useWatch("relation_types",i),h=(0,l.useState)([]),N=(0,S.Z)(h,2),p=N[0],x=N[1],E=(0,l.useState)(!1),j=(0,S.Z)(E,2),M=j[0],C=j[1],L=(0,l.useState)(er(e.edgeStat)),J=(0,S.Z)(L,2),D=J[0],I=J[1],O=(0,l.useState)(""),K=(0,S.Z)(O,2),H=K[0],$=K[1],ce=(0,l.useState)("Search nodes ..."),Se=(0,S.Z)(ce,2),pe=Se[0],B=Se[1],Q=(0,l.useState)(void 0),xe=(0,S.Z)(Q,2),ye=xe[0],be=xe[1];(0,l.useEffect)(function(){e.getNodeTypes().then(function(T){console.log("Get types of nodes: ",T);var v=[];T.node_types?(T.node_types.forEach(function(f){v.push({order:0,label:f,value:f})}),x(v)):x([])}).catch(function(T){console.log("requestNodes Error: ",T),Y.ZP.error("Get types of nodes error, please refresh the page"),x([])})},[]),(0,l.useEffect)(function(){var T,v,f,k,V,U,ae,ie="replace";(T=e.searchObject)!==null&&T!==void 0&&T.merge_mode&&(ie=e.searchObject.merge_mode);var he={};if(console.log("props.searchObject: ",e.searchObject),(v=e.searchObject)!==null&&v!==void 0&&v.limit||(he=(0,m.Z)((0,m.Z)({},he),{},{limit:50})),(f=e.searchObject)!==null&&f!==void 0&&f.topk||(he=(0,m.Z)((0,m.Z)({},he),{},{topk:10})),(k=e.searchObject)!==null&&k!==void 0&&k.query_mode||(he=(0,m.Z)((0,m.Z)({},he),{},{query_mode:"each"})),(V=e.searchObject)!==null&&V!==void 0&&V.nsteps||(he=(0,m.Z)((0,m.Z)({},he),{},{nsteps:1})),e.searchObject)for(var Oe in e.searchObject)e.searchObject[Oe]&&(he=(0,m.Z)((0,m.Z)({},he),{},(0,Je.Z)({},Oe,e.searchObject[Oe])));he=(0,m.Z)((0,m.Z)({},he),{},{merge_mode:ie}),i.setFieldsValue(he),(U=e.searchObject)!==null&&U!==void 0&&U.node_type&&(ae=e.searchObject)!==null&&ae!==void 0&&ae.node_id&&Me(e.searchObject.node_type,e.searchObject.node_id)},[e.searchObject]),(0,l.useEffect)(function(){return y&&y.length===0?s==="path"||b>1?$("Use all relation types instead of none, but it may take a long time to search."):$(Z?"Please select at least one relation type for performance if you enable prediction.":""):$(""),function(){$("")}},[Z,b,y]),(0,l.useEffect)(function(){c&&De(c,"node",function(T){if(console.log("fetchRelationshipTypes within node mode: ",T),T.length>0){var v=D==null?void 0:D.map(function(f){var k=T.find(function(U){var ae=U.label.split(" ")[1],ie=f.label.split(" ")[1];return ie===ae});if(k)return k;var V=f.label.split(" ")[1];return{order:9999,label:"[".concat("0".padStart(4,"0"),"] ").concat(V),value:f.value}});console.log("Update the number of relationships: ",v),I(v==null?void 0:v.sort(function(f,k){return f.order-k.order}))}})},[c]);var De=function(){var T=(0,qt.Z)((0,it.Z)().mark(function v(f,k,V){var U,ae,ie,he;return(0,it.Z)().wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:U="",ae="",ie="",k=="node"&&f?(U=':where [:or [:= :start_id "'.concat(f,`"]
                                  [:= :end_id "`).concat(f,'"]]'),ae="[[:count :*] :ncount]",ie="[[:ncount :desc]]"):k=="nodeType"&&f?(U=':where [:or [:= :source_type "'.concat(f,`"]
                                  [:= :target_type "`).concat(f,'"]]'),ae="[[:count :*] :ncount]",ie="[[:ncount :desc]]"):fail("Invalid query type or query string."),he=`
    {:select [`.concat(ae,` [:_type :relationship_type] 
              [:source_type :source_type] [:target_type :target_type] 
              [:resource :resource]]
      :from :relationships
      `).concat(U,`
      :group-by [:relationship_type :source_type :target_type :resource]
      :order-by `).concat(ie,`}
    `),e.getRelationships({query_str:he,disable_total:"true"}).then(function(Le){console.log("Get relationships: ",Le);var Xe=[];if(Le.data.length>0){var Ve=Tn(Le.data.map(function(Re){return Re.ncount}));Le.data.forEach(function(Re,tn){var yt=En(Re.relationship_type,Re.resource,Re.source_type,Re.target_type);Xe.push({order:tn,label:"[".concat(Re.ncount.toString().padStart(Ve,"0"),"] ").concat(yt),value:yt})}),V(Xe)}else V([])}).catch(function(Le){Y.ZP.error("Get relationships error, please refresh the page and try again."),console.log("Get relationships error: ",Le),V([])});case 6:case"end":return Qe.stop()}},v)}));return function(f,k,V){return T.apply(this,arguments)}}(),le=function(){var T=(0,qt.Z)((0,it.Z)().mark(function v(f,k,V){var U;return(0,it.Z)().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:Ut&&(clearTimeout(Ut),Ut=null),U=function(){C(!0),e.getLabels({query_str:kn({id:k,name:k},{},{}),label_type:f}).then(function(Oe){var Qe=Oe.data,Le=Qe.map(function(Ve){return{value:Ve.id,text:"".concat(Ve.id," | ").concat(Ve.name)}});console.log("getLabels results: ",Le);var Xe=Le.map(function(Ve){return{label:Ve.text,value:Ve.value}});C(!1),V(Xe)}).catch(function(Oe){console.log("requestNodes Error: ",Oe),V([]),C(!1)})},Ut=setTimeout(U,300);case 3:case"end":return ie.stop()}},v)}));return function(f,k,V){return T.apply(this,arguments)}}(),Te=function(v){be(void 0),B("Search ".concat(v," nodes ..."))},Me=function(v,f){f?le(v,f,be):be(void 0)},Ce=function(){$("")},Be=function(){i.validateFields().then(function(v){if(console.log("onConfirm form values: ",v),e.onOk){var f,k=(0,m.Z)((0,m.Z)({},v),{},{all_relation_types:D?D.map(function(V){return V.value}):[],enable_prediction:v.enable_prediction?v.enable_prediction:!1,relation_types:v.relation_types?v.relation_types:[],nodes:(f=e.searchObject)===null||f===void 0?void 0:f.nodes});e.onOk(k)}}).catch(function(v){console.log("errorInfo: ",v)})},F=s=="node",q=s=="batchIds",_=s=="similarity",ee=s=="batchNodes";return(0,t.jsxs)(fe.Z,{className:"query-form",layout:"horizontal",form:i,labelCol:{span:7},wrapperCol:{span:17},children:[(0,t.jsx)(fe.Z.Item,{name:"mode",label:"Mode",initialValue:"node",children:(0,t.jsxs)(mt.ZP.Group,{children:[(0,t.jsx)(mt.ZP,{value:"node",children:"Relationship"}),(0,t.jsx)(mt.ZP,{value:"batchIds",children:"Nodes"}),(0,t.jsx)(mt.ZP,{value:"similarity",children:"Similarity"}),((n=e.searchObject)===null||n===void 0?void 0:n.nodes)&&((a=e.searchObject)===null||a===void 0?void 0:a.nodes.length)>0&&(0,t.jsx)(mt.ZP,{value:"batchNodes",children:"BatchExpand"})]})}),(0,t.jsx)(fe.Z.Item,{label:"Node Type",name:"node_type",rules:[{required:!0,message:"Please select a node type."}],children:(0,t.jsx)(w.Z,{allowClear:!0,defaultActiveFirstOption:!1,showArrow:!0,placeholder:"Please select a node type",options:p,filterOption:!0,onSelect:Te})}),(0,t.jsx)(fe.Z.Item,{label:"Which Nodes",name:"node_ids",hidden:!q,rules:[{required:!!q,message:"Please enter your expected nodes."}],children:(0,t.jsx)(w.Z,{showSearch:!0,allowClear:!0,loading:M,mode:"multiple",defaultActiveFirstOption:!1,showArrow:!0,placeholder:pe,onSearch:function(v){return Me(u,v)},options:ye,filterOption:!1,notFoundContent:(0,t.jsx)(ke.Z,{description:M?"Searching...":ye!==void 0?"Not Found":"Enter your interested ".concat(u," ...")})})}),(0,t.jsx)(fe.Z.Item,{label:"Which Node",name:"node_id",hidden:q||ee,rules:[{required:!(q||ee),message:"Please enter your expected node."}],children:(0,t.jsx)(w.Z,{showSearch:!0,allowClear:!0,loading:M,defaultActiveFirstOption:!1,showArrow:!0,placeholder:pe,onSearch:function(v){return Me(u,v)},options:ye,filterOption:!1,notFoundContent:(0,t.jsx)(ke.Z,{description:M?"Searching...":ye!==void 0?"Not Found":"Enter your interested ".concat(u," ...")})})}),(0,t.jsx)(fe.Z.Item,{name:"relation_types",label:"Relation Types",hidden:q||_,validateStatus:H?"warning":"",help:H,rules:[{required:!1,message:"Please select your expected relation types!",type:"array"}],children:(0,t.jsx)(w.Z,{mode:"multiple",onChange:Ce,filterOption:function(v,f){return f.label.toLowerCase().indexOf(v.toLowerCase())>=0},allowClear:!0,autoClearSearchValue:!1,placeholder:"Please select relation types",options:D})}),(0,t.jsx)(fe.Z.Item,{label:"Query Mode",name:"query_mode",hidden:!ee,children:(0,t.jsx)(w.Z,{placeholder:"Please select query mode",options:ro})}),(0,t.jsx)(fe.Z.Item,{name:"nsteps",label:"Num of Steps",hidden:q||_||ee,rules:[{required:!1,message:"Please select your expected nsteps",type:"number"}],children:(0,t.jsx)(w.Z,{placeholder:"Please select nsteps",options:oo})}),(0,t.jsx)(fe.Z.Item,{name:"limit",label:"Max Num of Nodes",hidden:q||_,rules:[{required:!1,message:"Please input your expected value",type:"number"}],children:(0,t.jsx)(Hn.Z,{min:1,max:500})}),(0,t.jsx)(fe.Z.Item,{label:"Enable Prediction",name:"enable_prediction",hidden:q||_||ee,valuePropName:"checked",children:(0,t.jsx)(Ee.Z,{})}),(0,t.jsx)(fe.Z.Item,{name:"topk",label:"Top K",hidden:q||ee,rules:[{required:!1,message:"Please input your expected value",type:"number"}],children:(0,t.jsx)(Hn.Z,{min:1,max:100})}),(0,t.jsx)(fe.Z.Item,{label:"Merging Mode",name:"merge_mode",children:(0,t.jsx)(w.Z,{placeholder:"Please select mode for merging nodes & relationships",options:ao})}),(0,t.jsxs)(fe.Z.Item,{wrapperCol:{offset:19,span:5},children:[(0,t.jsx)(W.Z,{style:{marginRight:"10px"},onClick:e.onCancel,children:"Cancel"}),(0,t.jsx)(W.Z,{type:"primary",onClick:Be,children:"Search"})]})]})},lo=io,so=function(e){return(0,t.jsxs)("div",{className:"question-queryer",children:[(0,t.jsx)("h3",{children:"Question:"}),(0,t.jsx)(Bt.Z.TextArea,{rows:4,placeholder:"Please input your question",maxLength:6}),(0,t.jsx)("h3",{children:"Query (generated by AI):"}),(0,t.jsx)(Bt.Z.TextArea,{rows:4,placeholder:"Wait for your input...",maxLength:6}),(0,t.jsxs)("div",{className:"button-group",children:[(0,t.jsx)(W.Z,{onClick:e.onCancel,children:"Cancel"}),(0,t.jsx)(W.Z,{type:"primary",onClick:function(){e.onOk&&e.onOk({})},children:"Search"})]})]})},co=so,uo=function(e){var n=(0,l.useState)("single"),a=(0,S.Z)(n,2),o=a[0],r=a[1],i=(0,l.useState)([]),s=(0,S.Z)(i,2),c=s[0],u=s[1],Z=[{label:"Single Query",key:"single",children:(0,t.jsx)(lo,(0,m.Z)({edgeStat:e.edgeStat,onCancel:e.onCancel,onOk:e.onOk,searchObject:e.searchObject},e.apis))},{label:"Batch Query",key:"batch",children:(0,t.jsx)(Xr,{dataSource:c,onOk:e.onOk,onCancel:e.onCancel})},{label:"Ask Question",key:"question",children:(0,t.jsx)(co,{onCancel:e.onCancel,onOk:e.onOk})}];return(0,t.jsx)(et.Z,{className:"advanced-search",title:"Advanced Search",onCancel:e.onCancel,open:e.visible,destroyOnClose:!0,footer:null,getContainer:e.parent?e.parent:document.body,children:(0,t.jsx)(ve.Z,{defaultActiveKey:"single",activeKey:o,tabPosition:"left",items:Z,destroyInactiveTabPane:!0,onChange:function(y){r(y)},tabBarExtraContent:o==="batch"?(0,t.jsx)(no,{onUpload:function(y){u(y)},getLabels:e.apis.getLabels}):null})})},fo=uo,$n=d(25478),ho=d(66979),vo=d.n(ho),po=d(58660),go=d(74310),mo=d(75503),yo=function(e){var n=e.plotlyData,a=e.handleUpdate,o=e.mode,r=(0,l.useRef)(null),i=function(p,x,E){a&&a({data:p,layout:x,frames:E})},s=function(p,x,E){a&&a({data:p,layout:x,frames:E})},c=function(){console.log("PlotlyViewer handleResize: ",e.forceResize,r);var p=document.querySelector("#".concat(e.divId));e.divId&&e.forceResize&&p&&$n.relayout(e.divId,{autosize:!0})};(0,l.useEffect)(function(){if(e.divId&&e.forceResize){var N=document.querySelector("#".concat(e.divId)),p=new ResizeObserver(function(x){var E=(0,te.Z)(x),j;try{for(E.s();!(j=E.n()).done;){var M=j.value;console.log("Element size changed to ".concat(M.contentRect.width,"x").concat(M.contentRect.height)),M.target==N&&(console.log("Parent size changed"),c())}}catch(C){E.e(C)}finally{E.f()}});return N&&p.observe(N),function(){return p.disconnect()}}else return function(){}},[r]);var u={toImageButtonOptions:{format:"svg",filename:"custom_image",height:1e3,width:1e3,scale:1},editable:!0,scrollZoom:!1,displaylogo:!1,displayModeBar:!0,showTips:!0,responsive:!0,locales:{"zh-CN":mo},locale:(0,go.Kd)()};console.log("PlotlyViewer updated: ",e);var Z=n||{data:[],layout:{}},b=Z.data,y=Z.layout,h=Z.frames;return y=(0,m.Z)((0,m.Z)({},y),{},{margin:{t:50,r:50,b:50,l:50}}),o==="Plotly"?(0,t.jsx)(po.Z,{ref:r,divId:e.divId,useResizeHandler:!0,className:"plotly-viewer",data:b,layout:(0,m.Z)((0,m.Z)({},y),{},{autosize:!0}),config:u,onClick:e.onClick,frames:h}):(0,t.jsx)("div",{className:"plotly-editor",children:(0,t.jsx)(vo(),{ref:r,divId:e.divId,data:b,layout:(0,m.Z)((0,m.Z)({},y),{},{autosize:!0}),config:u,frames:h,plotly:$n,onClick:e.onClick,onUpdate:i,onRender:s,useResizeHandler:!0,advancedTraceTypeSelector:!0})})},Wt=(0,l.memo)(yo),$e=function(e,n,a,o){return{title:{text:e,font:{family:"Arial",size:"1.3rem",color:"#333333"},xref:"paper",x:0},xaxis:{zeroline:!0,zerolinecolor:"#333333",zerolinewidth:1,tickangle:315,title:{text:n,font:{family:"Arial",size:"1.1rem",color:"#333333"}},tickfont:{family:"Arial",size:"1rem",color:"#333333"},showgrid:!1,margin:{l:50,r:50,b:50,t:50,pad:4},automargin:o},yaxis:{title:{text:a,font:{family:"Arial",size:"1.1rem",color:"#333333"}},tickfont:{family:"Arial",size:"1rem",color:"#333333"},showgrid:!1,zeroline:!0,zerolinecolor:"#333333",zerolinewidth:1,margin:{l:50,r:50,b:50,t:50,pad:4},automargin:o},plot_bgcolor:"#ffffff",paper_bgcolor:"#ffffff"}},xo=function(e){var n=e.data,a=(0,l.useState)([]),o=(0,S.Z)(a,2),r=o[0],i=o[1];(0,l.useEffect)(function(){if(n.nodes.length!==0){var c=n.nodes,u=n.edges,Z=(0,se.uniqBy)(c,"nlabel").map(function(p){return p.nlabel}),b=(0,se.uniqBy)(u,"reltype").map(function(p){return p.reltype}),y=Z.map(function(p){return{type:p,count:c.filter(function(x){return x.nlabel===p}).length}}),h=b.map(function(p){return{type:p,count:u.filter(function(x){return x.reltype===p}).length}}),N=[];N.push({data:[{x:y.map(function(p){return p.type}),y:y.map(function(p){return p.count}),type:"bar",name:"Node Type Count",marker:{color:"#0083ff"}}],layout:$e("Node Type Count","Node Type","Count",!1)}),N.push({data:[{x:h.map(function(p){return p.type}),y:h.map(function(p){return p.count}),type:"bar",name:"Edge Type Count",marker:{color:"#0083ff"}}],layout:$e("Edge Type Count","Edge Type","Count",!1)}),i(N)}},[n]);var s=function(u){for(var Z="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",y=b.length,h=0;h<u;)Z+=b.charAt(Math.floor(Math.random()*y)),h+=1;return Z};return(0,t.jsx)(X.Z,{className:"complex-chart",children:r.length===0?(0,t.jsx)(we.Z,{span:24,children:(0,t.jsx)(ke.Z,{})}):r.map(function(c,u){return(0,t.jsx)(we.Z,{span:12,style:{height:"400px"},children:(0,t.jsx)(Wt,{mode:"Plotly",plotlyData:c,divId:"".concat(s(5)),forceResize:!0})},u)})})},Zo=xo,cl=d(7359),en=d(27279),Kt=function(e,n){return e.reduce(function(a,o){return(a[o[n]]=a[o[n]]||[]).push(o),a},{})},Qn=function(e,n,a,o){return e.forEach(function(r){r[o]=r[n]+"_"+r[a]}),e},So=function(e,n,a,o){var r=e.reduce(function(i,s){var c="".concat(s[n],"-").concat(s[a]);if(!i[c]){var u;i[c]=(u={},(0,Je.Z)(u,n,s[n]),(0,Je.Z)(u,a,s[a]),(0,Je.Z)(u,o,0),u)}return i[c][o]+=s[o],i},{});return Object.values(r)},Yn=function(e,n,a,o){var r=Object.values(e.reduce(function(i,s){var c=He.Z.snakeCase(s[n]);if(!i[c]){var u={};u[n]=s[n],i[c]=u}var Z=He.Z.snakeCase(s[a]);return i[c][Z]=s[o],i},{}));return r},_n=function(e){return e.reduce(function(n,a){return a.map(function(o,r){return(n[r]||[]).concat(a[r])})},[])},bo=function(e){var n=e.nodeStat,a=e.edgeStat,o=(0,l.useState)([]),r=(0,S.Z)(o,2),i=r[0],s=r[1],c=(0,l.useState)([]),u=(0,S.Z)(c,2),Z=u[0],b=u[1];(0,l.useEffect)(function(){if(n.length!==0&&a.length!==0){var h=[],N=n.reduce(function(B,Q){return B+Q.node_count},0),p=a.reduce(function(B,Q){return B+Q.relation_count},0);console.log("Node Count: ",N,"Edge Count: ",p),h.push({data:[{labels:["Node Count","Edge Count"],values:[N,p],type:"pie",textinfo:"value"}],layout:(0,m.Z)({},$e("Total Count","Type","Count",!0))});var x=Kt(n,"source"),E=Object.keys(x).map(function(B){return{x:x[B].map(function(Q){return Q.node_type}),y:x[B].map(function(Q){return Q.node_count}),type:"bar",name:B}});h.push({data:E,layout:(0,m.Z)((0,m.Z)({},$e("Node Count","Node Type","Count",!0)),{},{barmode:"stack"})}),x=Kt(n,"node_type"),E=Object.keys(x).map(function(B){return{x:x[B].map(function(Q){return Q.source}),y:x[B].map(function(Q){return Q.node_count}),type:"bar",name:B}}),h.push({data:E,layout:(0,m.Z)((0,m.Z)({},$e("Node Count","Source","Count",!0)),{},{barmode:"stack"})});var j=Kt(Qn(a,"start_node_type","end_node_type","rel"),"rel"),M=Object.keys(j).map(function(B){return{x:j[B].map(function(Q){return Q.source}),y:j[B].map(function(Q){return Q.relation_count}),type:"bar",name:B}});h.push({data:M,layout:(0,m.Z)((0,m.Z)({},$e("Relation Count","Source","Count",!0)),{},{barmode:"stack"})}),j=Kt(Qn(a,"start_node_type","end_node_type","rel"),"source"),M=Object.keys(j).map(function(B){return{x:j[B].map(function(Q){return Q.rel}),y:j[B].map(function(Q){return Q.relation_count}),type:"bar",name:B}}),h.push({data:M,layout:(0,m.Z)((0,m.Z)({},$e("Relation Count","Relationship Type","Count",!0)),{},{barmode:"stack"})}),s(h);var C="grey",L="lightgrey",J="white",D=[],I=Yn(n,"node_type","source","node_count"),O=Array.from(new Set(n.map(function(B){return B.source}))),K=_n(I.map(function(B){var Q=[B.node_type];return Q.concat(O.map(function(xe){var ye=He.Z.snakeCase(xe);return B[ye]===void 0?0:B[ye]}))})),H=K[0].length,$=Array.from({length:H},function(B,Q){return Q%2==0?L:J}),ce={type:"table",header:{values:["Node Type"].concat(O),align:["center","center"],line:{width:1,color:"black"},fill:{color:C},font:{family:"Arial",size:12,color:"white"}},cells:{values:K,align:["center","center"],line:{color:"black",width:1},fill:{color:[$]},font:{family:"Arial",size:11,color:["black"]},height:30,format:[[void 0,void 0],[void 0,",d"]]}};console.log("Table: ",ce,I,O,K),D.push({data:[ce],layout:{title:"Node Count"}});var Se=So(a,"source","relation_type","relation_count");I=Yn(Se,"relation_type","source","relation_count"),O=Array.from(new Set(a.map(function(B){return B.source}))),K=_n(I.map(function(B){var Q=[B.relation_type];return Q.concat(O.map(function(xe){var ye=He.Z.snakeCase(xe);return B[ye]===void 0?0:B[ye]}))})),H=K[0].length,$=Array.from({length:H},function(B,Q){return Q%2==0?L:J});var pe={type:"table",header:{values:["Relationship Type"].concat(O),align:["center","center"],line:{width:1,color:"black"},fill:{color:C},font:{family:"Arial",size:12,color:"white"}},cells:{values:K,align:["center","center"],line:{color:"black",width:1},fill:{color:[$]},font:{family:"Arial",size:11,color:["black"]},height:30,format:[[void 0,void 0],[void 0,",d"]]},columnwidth:Array.from({length:O.length},function(B,Q){return Q==0?150:50})};console.log("Table: ",pe,I,O,K),D.push({data:[pe],layout:{title:"Relationship Count"}}),b(D)}},[n,a]);var y=function(N){for(var p="",x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",E=x.length,j=0;j<N;)p+=x.charAt(Math.floor(Math.random()*E)),j+=1;return p};return(0,t.jsxs)(en.Z,{defaultActiveKey:["charts","tables"],children:[(0,t.jsx)(en.Z.Panel,{header:"Charts",children:(0,t.jsx)(X.Z,{className:"complex-chart",children:i.length===0?(0,t.jsx)(we.Z,{span:24,children:(0,t.jsx)(ke.Z,{})}):i.map(function(h,N){return(0,t.jsx)(we.Z,{span:12,style:{height:"350px",marginBottom:"10px"},children:(0,t.jsx)(Wt,{mode:"Plotly",plotlyData:h,divId:"".concat(y(5)),forceResize:!0})},N)})})},"charts"),(0,t.jsx)(en.Z.Panel,{header:"Tables",children:(0,t.jsx)(X.Z,{className:"complex-chart",children:Z.length===0?(0,t.jsx)(we.Z,{span:24,children:(0,t.jsx)(ke.Z,{})}):Z.map(function(h,N){return(0,t.jsx)(we.Z,{span:24,style:{height:"350px",marginBottom:"10px"},children:(0,t.jsx)(Wt,{mode:"Plotly",plotlyData:h,divId:"".concat(y(5)),forceResize:!0})},N)})})},"tables")]})},Co=bo,jo=function(e){var n=e.node,a=(0,l.useState)(void 0),o=(0,S.Z)(a,2),r=o[0],i=o[1];return(0,l.useEffect)(function(){},[n]),(0,t.jsxs)(ve.Z,{className:"disease-info-panel",children:[(0,t.jsx)(ve.Z.TabPane,{tab:"Disease Info",children:"Comming Soon..."},"disease-info"),(0,t.jsx)(ve.Z.TabPane,{tab:"Clinical Trials",children:(0,t.jsx)("img",{width:"100%",src:"/examples/clinical-trials.png"})},"clinical-trails")]})},No=jo,wo=function(e){var n=e.node,a=(0,l.useState)(void 0),o=(0,S.Z)(a,2),r=o[0],i=o[1];return(0,l.useEffect)(function(){},[n]),(0,t.jsxs)(ve.Z,{className:"drug-info-panel",children:[(0,t.jsx)(ve.Z.TabPane,{tab:"Drug Info",children:"Comming Soon..."},"drug-info"),(0,t.jsx)(ve.Z.TabPane,{tab:"3D Structure",children:"Comming Soon..."},"drug-3d")]})},ko=wo,Po=function(e){var n=e.split(":"),a=(0,S.Z)(n,2),o=a[0],r=a[1];return r?{source:o,id:r}:{source:"unknown",id:o}},Eo=function(e){var n=Po(e),a=n.id;return a},Io=function(e){var n=e.node,a=(0,l.useState)(void 0),o=(0,S.Z)(a,2),r=o[0],i=o[1],s=(0,l.useState)([{label:"Summary",key:"summary",checked:!0},{label:"Gene",key:"gene",checked:!0},{label:"Transcript",key:"transcript",checked:!0},{label:"Mutation",key:"mutation",checked:!0},{label:"3D Structure",key:"structure",checked:!0},{label:"Sgrna",key:"sgrna",checked:!0}]),c=(0,S.Z)(s,2),u=c[0],Z=c[1],b=(0,l.useState)([]),y=(0,S.Z)(b,2),h=y[0],N=y[1];(0,l.useEffect)(function(){if(n){var E=Eo(n.data.id);e.getGeneInfo(E).then(function(j){i(j),N(e.getItems4GenePanel(j,(0,se.filter)(u,function(M){return!M.checked})))}).catch(function(j){console.log("getGeneInfo Error: ",j),i(void 0)})}},[n,u]);var p=function(){var j=function(C){var L=C.target,J=L.checked,D=L.value;Z(J?(0,se.map)(u,function(I){return I.key===D&&(I.checked=!0),I}):(0,se.map)(u,function(I){return I.key===D&&(I.checked=!1),I}))};return(0,t.jsx)("div",{children:h.map(function(M){return(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"checkbox",defaultChecked:M.checked,value:M.key,onChange:j}),"\xA0",(0,t.jsx)("span",{children:M.label})]},M.key)})})},x=(0,t.jsx)(mn.Z,{content:p(),children:(0,t.jsx)(W.Z,{shape:"circle",className:"tabs-extra-button",icon:(0,t.jsx)(Gt.Z,{})})});return(0,t.jsx)(ve.Z,{className:"gene-info-panel tabs-nav-right",tabBarExtraContent:{left:x,right:null},items:h})},To=Io,Do=function(e){var n=e.node,a=function(r){if(r){var i=r.nlabel.toLocaleLowerCase();if(["gene","protein"].includes(i))return(0,t.jsx)(To,{node:r,getGeneInfo:e.getGeneInfo,getItems4GenePanel:e.getItems4GenePanel});if(["drug","chemical","compound"].includes(i))return(0,t.jsx)(ko,{node:r});if(["disease"].includes(i))return(0,t.jsx)(No,{node:r})}return(0,t.jsx)(ke.Z,{})};return(0,t.jsx)(X.Z,{className:"node-info-panel",children:a(n)})},Mo=Do,Go=function(e){var n=e.edgeInfo||{edge:void 0,startNode:void 0,endNode:void 0},a=n.edge,o=n.startNode,r=n.endNode;return(0,l.useEffect)(function(){},[a,o,r]),(0,t.jsxs)(ve.Z,{className:"drug-gene-info-panel",children:[(0,t.jsx)(ve.Z.TabPane,{tab:"DrugGene Info",children:"We can show the drug-gene association information here. Maybe it's summarized information from publications."},"drug-gene-info"),(0,t.jsx)(ve.Z.TabPane,{tab:"Drug Targets",children:"Comming soon..."},"clinical-trails")]})},Oo=Go,Lo=function(e){var n=e.edgeInfo||{edge:void 0,startNode:void 0,endNode:void 0},a=n.edge,o=n.startNode,r=n.endNode;return(0,l.useEffect)(function(){},[a,o,r]),(0,t.jsxs)(ve.Z,{className:"drug-disease-info-panel tabs-nav-right",children:[(0,t.jsx)(ve.Z.TabPane,{tab:"DrugDisease Info",children:"We can show the drug-disease association information here. Maybe it's summarized information from clinical trials, or publications."},"drug-disease-info"),(0,t.jsx)(ve.Z.TabPane,{tab:"Patents",children:"We can show the patents information here. Maybe it's summarized information from patents database."},"drug-patent-info"),(0,t.jsx)(ve.Z.TabPane,{tab:"Products",children:"We can show the production information here. Maybe it's summarized information from drug production database."},"drug-product-info")]})},Ro=Lo,Fo=function(e){var n=e.edgeInfo||{edge:void 0,startNode:void 0,endNode:void 0},a=n.edge,o=n.startNode,r=n.endNode;return(0,l.useEffect)(function(){console.log("GeneDiseasePanel: ",a,o,r)},[a,o,r]),(0,t.jsxs)(ve.Z,{className:"gene-disease-info-panel tabs-nav-right",children:[(0,t.jsx)(ve.Z.TabPane,{tab:"GeneDiease Info",children:"We can show the gene-disease association information here. Maybe it's summarized information from publications."},"gene-disease-info"),(0,t.jsx)(ve.Z.TabPane,{tab:"Diff Expression",children:"we can show the diff expression here. It can tell us whether the gene is up-regulated or down-regulated in the disease."},"diff-expr"),(0,t.jsx)(ve.Z.TabPane,{tab:"Biomarkers",children:"we can show the related biomarkers. It can tell us which genes are the biomarkers of the disease."},"biomarker")]})},Ao=Fo,zo=function(e){var n=e.edgeInfo||{edge:void 0,startNode:void 0,endNode:void 0},a=n.edge,o=n.startNode,r=n.endNode,i=(0,l.useState)("Unknown"),s=(0,S.Z)(i,2),c=s[0],u=s[1],Z=function(y){switch(console.log("whichPanel: ",y),y){case"DrugDisease":return(0,t.jsx)(Ro,{edgeInfo:e.edgeInfo});case"DrugGene":return(0,t.jsx)(Oo,{edgeInfo:e.edgeInfo});case"GeneDisease":return(0,t.jsx)(Ao,{edgeInfo:e.edgeInfo});default:return(0,t.jsx)(ke.Z,{})}};return(0,l.useEffect)(function(){if(console.log("EdgeInfoPanel: ",a,o,r),a&&o&&r){var b=o.nlabel,y=r.nlabel,h=[b,y].sort().join("");console.log("relationTypes: ",h,c),u(""),["CompoundDisease","ChemicalDisease","DiseaseDrug"].indexOf(h)>=0&&u("DrugDisease"),["DiseaseGene","GeneDisease"].indexOf(h)>=0&&u("GeneDisease"),["CompoundGene","ChemicalGene","DrugGene"].indexOf(h)>=0&&u("DrugGene")}},[a,o,r]),(0,t.jsx)(X.Z,{className:"edge-info-panel",children:Z(c)})},Bo=zo,ul=d(32157),Vo=d(82363),Uo=function(e){var n={name:"file",action:"/api/upload",showUploadList:!1,beforeUpload:function(o){var r=new FileReader;return r.readAsText(o),r.onload=function(){try{var i=JSON.parse(r.result);e.onUpload&&e.onUpload(i)}catch(s){Jt.Z.error({message:"Failed to parse file",description:"Please make sure the file is a valid JSON file"})}},r.onerror=function(i){Y.ZP.error("Failed to read file")},!1}};return(0,t.jsx)(Wn.Z,(0,m.Z)((0,m.Z)({},n),{},{children:(0,t.jsx)(W.Z,{icon:(0,t.jsx)(Kn.Z,{}),children:"Upload"})}))},Wo=Uo,Ko=Vo.Z.DirectoryTree,Ho=function(e){var n={};e.forEach(function(i){n[i.id]=i});var a=[];e.forEach(function(i){if(console.log("parent: ",i.parent,"id: ",i.id),i.parent===i.id){var s=(0,m.Z)((0,m.Z)({},i),{},{title:i.name,key:i.id});a.push(s)}else{var c=n[i.parent];c&&(c.children=c.children||[],c.children.push((0,m.Z)((0,m.Z)({},i),{},{title:i.name+"-"+i.id.slice(0,8),key:i.id,isLeaf:!0})))}});var o=function i(s){var c=[];return s.forEach(function(u){u.children?c=c.concat(i(u.children).concat([(0,m.Z)((0,m.Z)({},u),{},{children:void 0})])):c.push(u)}),c},r=[];return a.forEach(function(i){i.children?i.children=o(i.children).concat((0,m.Z)((0,m.Z)({},i),{},{children:void 0})):i.children=[(0,m.Z)((0,m.Z)({},i),{},{children:void 0})],r.push(i)}),console.log("makeTree",e,n,a,r),r},$o=function(e){var n=6,a=l.useState([]),o=(0,S.Z)(a,2),r=o[0],i=o[1],s=l.useState([]),c=(0,S.Z)(s,2),u=c[0],Z=c[1],b=l.useState([]),y=(0,S.Z)(b,2),h=y[0],N=y[1],p=l.useState(n),x=(0,S.Z)(p,2),E=x[0],j=x[1],M=[{title:"Name",dataIndex:"name",key:"name",align:"center",width:150,fixed:"left"},{title:"Created At",dataIndex:"created_time",key:"created_time",align:"center",render:function(D){return new Date(D).toLocaleString()},width:200},{title:"Version",key:"version",align:"center",dataIndex:"version",width:100},{title:"UUID",key:"id",align:"center",dataIndex:"id",width:200},{title:"DB Version",key:"db_version",align:"center",dataIndex:"db_version",width:150},{title:"Action",key:"action",align:"center",fixed:"right",width:240,render:function(D,I,O){return(0,t.jsxs)(Xt.Z,{size:"small",children:[(0,t.jsxs)(W.Z,{size:"small",type:"link",disabled:e.selectedGraphId===I.id,onClick:function(H){if(h){var $=h[O];$&&e.onLoad(I,$)}else console.log("GraphTable load: something wrong.",h,O,I),e.onLoad(I,I)},children:["Load",e.selectedGraphId===I.id?"ed":""]}),(0,t.jsx)(W.Z,{size:"small",type:"link",onClick:function(H){var $=JSON.stringify(I),ce=new Blob([$],{type:"application/json"}),Se=URL.createObjectURL(ce),pe=document.createElement("a");pe.href=Se,pe.download=I.name+".json",document.body.appendChild(pe),pe.click(),document.body.removeChild(pe)},children:"Download"}),(0,t.jsx)(W.Z,{size:"small",type:"link",danger:!0,onClick:function(H){return e.onDelete(I)},children:"Delete"})]})}}],C=function(D,I){if(console.log("Trigger Select",D,I),I.selectedNodes[0]&&I.selectedNodes[0].children){var O=I.selectedNodes[0];N(O.children),Z(D)}else Z([]),N([])},L=function(D,I){console.log("Trigger Expand",D,I)};return(0,l.useEffect)(function(){if(e.treeFormat){var J=Ho(e.graphs);i(J);var D=J[0]?J[0].children:[];N(D),j(n),Z(J[0]?[J[0].key]:[])}else N(e.graphs),j(0)},[e.graphs]),(0,t.jsx)(et.Z,{className:"graph-table",title:"Graph Table",open:e.visible,width:1e3,closable:!0,onCancel:e.onClose,getContainer:e.parent?e.parent:document.body,footer:e.onUpload?[(0,t.jsx)(Wo,{onUpload:function(D){if(e.onUpload){var I=D;delete I.parent,delete I.created_time,e.onUpload(I)}}},"upload-graph")]:null,children:(0,t.jsxs)(X.Z,{gutter:16,children:[(0,t.jsx)(we.Z,{span:E,children:e.treeFormat?(0,t.jsx)(Ko,{defaultExpandAll:!0,selectedKeys:u,onSelect:C,onExpand:L,treeData:r,fieldNames:{title:"title",key:"key",children:"notShown"}}):null}),(0,t.jsx)(we.Z,{span:24-E,children:(0,t.jsx)(Ye.Z,{rowKey:"id",columns:M,dataSource:h,pagination:!1,scroll:{y:500,x:800},size:"small",expandable:{expandedRowRender:function(D){return(0,t.jsx)("p",{style:{margin:0},children:D.description||"No description"})},rowExpandable:function(D){return D.name!=="Not Expandable"}}})})]})})},Qo=$o,Yo=d(17566),_o=function(e){var n=(0,l.useContext)(Ie.Z),a=n.graph,o=function(s){if(e.payload)if(a){console.log("Save graph data which are from graphin.");var c=Rn(a);e.onSubmit((0,m.Z)({payload:c},s))}else console.log("Save graph data which are from server."),e.onSubmit((0,m.Z)({payload:e.payload},s))},r=function(s){console.log("Failed:",s),Y.ZP.error("Failed to submit graph")};return(0,t.jsx)(et.Z,{className:"graph-form",title:"Save the current graph",open:e.visible,footer:null,width:500,closable:!0,onCancel:e.onClose,destroyOnClose:!0,getContainer:e.parent?e.parent:document.body,children:(0,t.jsxs)(fe.Z,{name:"basic",labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},onFinish:o,onFinishFailed:r,autoComplete:"off",children:[(0,t.jsx)(fe.Z.Item,{label:"name",name:"name",rules:[{required:!0,message:"Please input a graph name!"}],children:(0,t.jsx)(Bt.Z,{placeholder:"Please input a graph name"})}),(0,t.jsx)(fe.Z.Item,{label:"description",name:"description",rules:[{required:!1,message:"Please input description!"}],children:(0,t.jsx)(Yo.Z,{rows:5,placeholder:"Please input description!"})}),(0,t.jsx)(fe.Z.Item,{wrapperCol:{offset:20,span:4},children:(0,t.jsx)(W.Z,{type:"primary",htmlType:"submit",children:"Submit"})})]})})},Jo=_o,Xo=function(e){for(var n="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=a.length,r=0;r<e;)n+=a.charAt(Math.floor(Math.random()*o)),r+=1;return n},qo=function(e){var n=(0,l.useContext)(gn),a=e.data,o=(0,l.useState)([]),r=(0,S.Z)(o,2),i=r[0],s=r[1],c=(0,l.useState)(Xo(5)),u=(0,S.Z)(c,2),Z=u[0],b=u[1];(0,l.useEffect)(function(){var h=[];if(n.selectedNodes){var N;console.log("graphinContext.selectedNodes: ",n.selectedNodes),h=(N=n.selectedNodes)===null||N===void 0?void 0:N.map(function(j){return j.data.id})}if(a.length!==0){var p=[],x=[],E={};a.forEach(function(j){E[j.nlabel]?E[j.nlabel].push(j):E[j.nlabel]=[j]}),Object.keys(E).forEach(function(j){var M=E[j],C=M.map(function(O){return O.x}),L=M.map(function(O){return O.y}),J=M.map(function(O){return O.nlabel}),D=[];h?D=M.map(function(O){return console.log("item.data.id: ",O.data.id,h),h.includes(O.data.id)?O.data.name:""}):D=M.map(function(O){return O.data.name});var I=M.map(function(O){return O.data.id});x.push({x:C,y:L,type:"scatter",mode:"markers+text",textposition:"bottom center",text:D,customdata:M,name:J[0],extra:I,marker:{color:M[0].style.keyshape.fill,size:10},hovertemplate:"<b>%{customdata.data.name}</b><br>%{customdata.data.id}<br>%{yaxis.title.text}: %{y}<br>%{xaxis.title.text}: %{x}<br><extra></extra>",texttemplate:"%{text}"})}),p.push({data:x,layout:$e("","X","Y",!1)}),console.log("localCharts: ",p),s(p)}},[a,n.selectedNodes]);var y=function(N){if(N.points.length===1){var p=N.points[0];p.customdata&&e.onClick&&e.onClick(p.customdata)}else console.log("onPlotlyClick: ",N),Y.ZP.info("Please click one node to focus.")};return(0,t.jsxs)(X.Z,{className:"complex-chart",children:[e.description?(0,t.jsx)("span",{className:"notice",children:e.description}):null,i.length===0?(0,t.jsx)(we.Z,{span:24,children:(0,t.jsx)(ke.Z,{})}):i.map(function(h,N){return(0,t.jsx)(we.Z,{span:24,style:{height:"400px"},children:(0,t.jsx)(Wt,{mode:"Plotly",plotlyData:h,divId:"".concat(Z),onClick:y,forceResize:!0})},N)})]})},ei=qo,ti={backgroundImage:"url(".concat(window.publicPath+"graph-background.png",")")},ni=function(e){var n=e.apis,a=(0,se.partial)(ar,n),o=(0,se.partial)(nr,n),r=(0,se.partial)(qa,n),i=et.Z.useModal(),s=(0,S.Z)(i,2),c=s[0],u=s[1],Z=(0,l.useState)({nodes:[],edges:[]}),b=(0,S.Z)(Z,2),y=b[0],h=b[1],N=(0,l.useState)([]),p=(0,S.Z)(N,2),x=p[0],E=p[1],j=(0,l.useState)([]),M=(0,S.Z)(j,2),C=M[0],L=M[1],J=(0,l.useState)([]),D=(0,S.Z)(J,2),I=D[0],O=D[1],K=(0,l.useState)([]),H=(0,S.Z)(K,2),$=H[0],ce=H[1],Se=(0,l.useState)([]),pe=(0,S.Z)(Se,2),B=pe[0],Q=pe[1],xe=(0,l.useState)(!1),ye=(0,S.Z)(xe,2),be=ye[0],De=ye[1],le=(0,l.useState)(!1),Te=(0,S.Z)(le,2),Me=Te[0],Ce=Te[1],Be=(0,l.useState)([]),F=(0,S.Z)(Be,2),q=F[0],_=F[1],ee=(0,l.useState)([]),T=(0,S.Z)(ee,2),v=T[0],f=T[1],k=(0,l.useState)(!1),V=(0,S.Z)(k,2),U=V[0],ae=V[1],ie=(0,l.useState)(void 0),he=(0,S.Z)(ie,2),Oe=he[0],Qe=he[1],Le=(0,l.useState)(!1),Xe=(0,S.Z)(Le,2),Ve=Xe[0],Re=Xe[1],tn=(0,l.useState)(void 0),yt=(0,S.Z)(tn,2),Xn=yt[0],qn=yt[1],di=(0,l.useState)(!1),ea=(0,S.Z)(di,2),ci=ea[0],nn=ea[1],ui=(0,l.useState)([]),ta=(0,S.Z)(ui,2),fi=ta[0],na=ta[1],hi=(0,l.useState)("activate"),aa=(0,S.Z)(hi,2),vi=aa[0],ra=aa[1],pi=(0,l.useState)(""),oa=(0,S.Z)(pi,2),gi=oa[0],an=oa[1],mi=(0,l.useState)([]),ia=(0,S.Z)(mi,2),yi=ia[0],xi=ia[1],Zi=(0,l.useState)(!1),la=(0,S.Z)(Zi,2),rn=la[0],sa=la[1],Si=(0,l.useState)({node_type:"",node_id:"",nsteps:1,merge_mode:"replace",enable_prediction:!1,limit:50}),da=(0,S.Z)(Si,2),Fe=da[0],xt=da[1],bi=l.useState(rr),ca=(0,S.Z)(bi,2),ua=ca[0],fa=ca[1],Ci=(0,l.useState)("New Graph"),ha=(0,S.Z)(Ci,2),on=ha[0],va=ha[1],ji=(0,l.useState)("New Graph"),pa=(0,S.Z)(ji,2),ln=pa[0],ga=pa[1],Ni=(0,l.useState)(!1),ma=(0,S.Z)(Ni,2),ya=ma[0],sn=ma[1],wi=(0,l.useState)([]),xa=(0,S.Z)(wi,2),ki=xa[0],Pi=xa[1],Ei=(0,l.useState)(!1),Za=(0,S.Z)(Ei,2),Ii=Za[0],dn=Za[1],Ti=(0,l.useState)(!1),Sa=(0,S.Z)(Ti,2),Di=Sa[0],cn=Sa[1],Mi=(0,l.useState)({}),ba=(0,S.Z)(Mi,2),Gi=ba[0],Oi=ba[1],qe=function(P){var R=new Set(P.nodes.map(function(re){return re.id})),ne=P.edges.filter(function(re){return!R.has(re.source)||!R.has(re.target)}),ue=P.edges.filter(function(re){return R.has(re.source)&&R.has(re.target)});sn(!0),h({nodes:P.nodes,edges:Xa(ue,{})})},Li=function(){h({nodes:[],edges:[]}),va(""),ga("")},Ri=function(P,R){return(0,t.jsxs)("span",{children:[P?(0,t.jsx)(Ae.Z,{color:"#f50",children:"dirty"}):(0,t.jsx)(Ae.Z,{color:"#87d068",children:"cleaned"}),"\xA0",R]})};(0,l.useEffect)(function(){var z=Nn(y.nodes);O(z);var P=jn(z,["comboId","style","data"]);L(P);var R=Nn(y.edges);Q(R);var ne=jn(R,[]);ce(ne),console.log("Node & Edge Columns: ",P,ne),E([[(0,t.jsxs)("span",{children:["Nodes ",(0,t.jsx)(Ae.Z,{color:"#2db7f5",children:"Canvas"})]}),y.nodes.length],[(0,t.jsxs)("span",{children:["Edges ",(0,t.jsx)(Ae.Z,{color:"#2db7f5",children:"Canvas"})]}),y.edges.length],[(0,t.jsxs)("span",{children:["Nodes ",(0,t.jsx)(Ae.Z,{color:"#108ee9",children:"KGraph"})]}),q.reduce(function(ue,re){return ue+re.node_count},0).toLocaleString()],[(0,t.jsxs)("span",{children:["Edges ",(0,t.jsx)(Ae.Z,{color:"#108ee9",children:"KGraph"})]}),v.reduce(function(ue,re){return ue+re.relation_count},0).toLocaleString()],[(0,t.jsxs)("span",{children:["Status ",(0,t.jsx)(Ae.Z,{color:"#2db7f5",children:"Canvas"})]}),Ri(ya,ln)]])},[y,v,q,ln]);var un=function(){n.getGraphHistory({page:1,page_size:100}).then(function(P){Pi(P.data)}).catch(function(P){console.log(P),Y.ZP.error("Failed to get graph histories, please check the network connection.")})},Fi=function(P,R,ne,ue){return new Promise(function(re,We){n.postDimensionReduction({source_id:P,source_type:R,target_ids:ne,target_types:ue}).then(function(je){console.log("Get dimensions: ",je),re(je.data)}).catch(function(je){console.log("Error when getting dimensions: ",je),We([])})})},Ca=function(P,R){var ne=P.payload;ne&&(sn(!1),va(R.id),ga(P.id),qe(ne.data),fa(ne.layout),De(ne.toolbarVisible),dn(!1))},Ai=function(P,R){console.log("Load graph: ",P,R),ya?c.confirm({title:"You have unsaved changes",icon:(0,t.jsx)(ft.Z,{}),content:"Are you sure to load another graph?",okText:"Load",cancelText:"Cancel",onOk:function(){sn(!1),Ca(P,R)},onCancel:function(){}}):Ca(P,R)},zi=function(P){n.deleteGraphHistory({id:P.id}).then(function(R){Y.ZP.success("Graph deleted successfully."),un()}).catch(function(R){console.log(R),Y.ZP.error("Failed to delete graph, please check the network connection.")})};(0,l.useEffect)(function(){n.getStatistics().then(function(z){_(z.node_stat),f(z.relationship_stat)}).catch(function(z){console.log(z),Y.ZP.error("Failed to get statistics, please check the network connection.")}),un()},[]),(0,l.useEffect)(function(){rn===!1&&tr(Fe)?(Ce(!0),Y.ZP.info("Loading data, please wait..."),o(Fe).then(function(z){if(console.log("Query Graph Response: ",z),Fe.merge_mode=="replace")qe(z);else if(Fe.merge_mode=="append")qe({nodes:(0,se.uniqBy)([].concat((0,me.Z)(y.nodes),(0,me.Z)(z.nodes)),"id"),edges:(0,se.uniqBy)([].concat((0,me.Z)(y.edges),(0,me.Z)(z.edges)),"relid")});else if(Fe.merge_mode=="subtract"){var P=z.nodes,R=z.edges,ne=P.map(function(je){return je.id});ne=ne.filter(function(je){var Zt=function(dt,bt,Ct){return(dt.target==bt||dt.source==bt)&&Ct.indexOf(dt.reltype)>-1},st=Fe.relation_types||R.map(function(Ke){return Ke.reltype}),St=y.edges.filter(function(Ke){return Zt(Ke,je,st)});return console.log("Found: ",St,je,st),St.length<2});var ue=y.nodes.filter(function(je){return!ne.includes(je.id)}),re=y.edges.filter(function(je){return!ne.includes(je.source)&&!ne.includes(je.target)}),We={nodes:ue,edges:re};console.log("New Data: ",We,y,z,ne),qe(We)}else Y.ZP.warn("Unknown merge mode, please retry later.");Y.ZP.success("Find ".concat(z.nodes.length," entities and ").concat(z.edges.length," relationships.")),Ce(!1)}).catch(function(z){console.log("getNodes Error: ",z),Y.ZP.warn("Unknown errors or Cannot find any entities & relationships."),Ce(!1)})):console.log("Advanced Search Panel is active or search object is invalid: ",rn,Fe)},[Fe]);var fn=function(){sa(!0)},ja=function(){sa(!1)},Bi=function(P){console.log("Search Object: ",P),ja(),xt(P)},Vi=function(P,R){xt({mode:"node",node_type:P,node_id:R,merge_mode:"replace",nsteps:1,limit:50,enable_prediction:!1})},Ui=function(P,R,ne){if(P.key=="auto-connect"){Y.ZP.info("Auto connecting nodes, please wait..."),Ce(!0);var ue=R.getNodes().map(function(re){return re.getModel()});r(ue).then(function(re){console.log("Auto Connect Response: ",re),qe({nodes:(0,se.uniqBy)([].concat((0,me.Z)(y.nodes),(0,me.Z)(re.nodes)),"id"),edges:(0,se.uniqBy)([].concat((0,me.Z)(y.edges),(0,me.Z)(re.edges)),"relid")}),re.nodes.length==0&&re.edges.length==0?Y.ZP.warn("No more relationships can be found."):Y.ZP.success("Find ".concat(re.nodes.length," entities and ").concat(re.edges.length," relationships."))}).catch(function(re){console.log("Auto Connect Error: ",re),Y.ZP.warn("Something went wrong, please try again later.")}).finally(function(){Ce(!1)})}},Wi=function(P,R,ne,ue,re,We){P.key=="what-is-the-relationship"?e.postMessage&&e.postMessage("what is the relationship between ".concat(R.data.name," and ").concat(ne.data.name,"?")):P.key=="show-edge-details"&&(Re(!0),qn({startNode:R,endNode:ne,edge:ue}))},Ki=function(P,R,ne,ue){if(console.log("onNodeMenuClick [".concat(P.key,"]: "),P,R),P.key=="delete-nodes"){var re=zt(ne),We=(0,me.Z)(re.map(function(de){return de.id}));if(re.length==0){Y.ZP.info("Please select one or more nodes to delete.");return}else Y.ZP.info("Deleting ".concat(re.length," nodes, please wait...")),re.forEach(function(de){ne.removeItem(de.id)}),qe({nodes:y.nodes.filter(function(de){return!We.includes(de.id)}),edges:y.edges.filter(function(de){return!We.includes(de.source)&&!We.includes(de.target)})})}else if(P.key=="expand-one-level")fn(),xt({node_type:R.nlabel,node_id:R.data.id,merge_mode:"append"});else if(["expand-all-paths-1","expand-all-paths-2","expand-all-paths-3"].includes(P.key)){console.log("Expand All Paths: ",P.key);var je=zt(ne);if(je.length==0){Y.ZP.info("Please select one or more nodes to expand.");return}else xt({nodes:je,merge_mode:"append",mode:"path",nsteps:parseInt(P.key.split("-").pop()||"1"),limit:50})}else if(P.key=="expand-selected-nodes"){var Zt=zt(ne);Zt.length==0&&R&&Zt.push(R),fn(),xt({nodes:Zt,merge_mode:"append",mode:"batchNodes",node_id:"",node_type:""})}else if(P.key=="what-is-the-node")e.postMessage&&e.postMessage("what is the ".concat(R.data.name,"?"));else if(P.key=="predict-relationships"){var st="".concat(R.nlabel,"::").concat(R.data.id),St=zt(ne),Ke=St.map(function(de){return"".concat(de.nlabel,"::").concat(de.data.id)});Ke=Ke.filter(function(de){return de!=st}),console.log("Predict Relationships: ",P,st,Ke,St),a(st,Ke).then(function(de){console.log("Predict Relationships Response: ",de),de.nodes.length==0&&de.edges.length==0?Y.ZP.warn("No more relationships can be found."):qe({nodes:(0,se.uniqBy)([].concat((0,me.Z)(y.nodes),(0,me.Z)(de.nodes)),"id"),edges:(0,se.uniqBy)([].concat((0,me.Z)(y.edges),(0,me.Z)(de.edges)),"relid")})}).catch(function(de){console.log("Predict Relationships Error: ",de),Y.ZP.warn("Something went wrong, please try again later.")})}else if(P.key=="visulize-similarities"){var dt=lr(ne),bt=R.nlabel,Ct=R.data.id,ka=dt.filter(function(de){return de.data.id!=Ct}),Pa=ka.map(function(de){return de.nlabel}),Ea=ka.map(function(de){return de.data.id});Ce(!0),Fi(Ct,bt,Ea,Pa).then(function(de){console.log("Get Dimensions Response: ",de,Ea,Pa,Ct,bt);var Xi=de.map(function(ct){var Ia=dt.filter(function(Ta){return Ta.data.id==ct.node_id&&Ta.nlabel==ct.node_type});return Ia.length>0?(0,m.Z)((0,m.Z)({},Ia[0]),{},{x:ct.x,y:ct.y}):{}}).filter(function(ct){return Object.keys(ct).length>0});na(Xi),nn(!0),Ce(!1)}).catch(function(de){console.log("Get Dimensions Error: ",de),na([]),nn(!1),Y.ZP.error("Failed to get similarities, please check the network connection."),Ce(!1)}).finally(function(){Ce(!1)})}else P.key=="show-node-details"&&(ae(!0),Qe(R))},Hi={selectedRowKeys:yi},$i=function(P){var R=l.Children.count(P.children),ne=l.Children.toArray(P.children),ue=[{label:"Nodes",key:"nodes",children:R>=2?ne[0]:"No Content"},{label:"Edges",key:"edges",children:R>=2?ne[1]:"No Content"}];return(0,t.jsx)(ve.Z,{className:"tabs-nav-center",children:ue.map(function(re){return(0,t.jsx)(ve.Z.TabPane,{tab:re.label,children:re.children},re.key)})})},Qi=function(){cn(!0),Oi({data:y,layout:ua,toolbarVisible:be})},Yi=function(){De(!be)},_i=function(P,R){console.log("Node Clicked: ",P,y,R),R&&(ae(!0),Qe(R))},Ji=function(P,R,ne,ue){console.log("Edge Clicked: ",P),P&&(Re(!0),qn({edge:ue,startNode:R,endNode:ne}))},Na=function(){Re(!1),ae(!1)},lt=(0,Mt.r)(),wa=function(P){return new Promise(function(R,ne){on&&ir(on)&&(P=(0,m.Z)((0,m.Z)({},P),{},{parent:on})),delete P.id,n.postGraphHistory(P).then(function(ue){return Y.ZP.success("Graph data saved."),un(),R(ue)}).catch(function(ue){return console.log("Post Graphs Error: ",ue),Y.ZP.error("Graph save failed."),ne(ue)})})};return(0,t.jsx)(Mt.I,{handle:lt,children:(0,t.jsx)(X.Z,{className:"knowledge-graph-container",id:"knowledge-graph-container",children:(0,t.jsxs)($t.Z,{spinning:Me,children:[(0,t.jsxs)(X.Z,{className:"left-toolbar",children:[(0,t.jsx)(ut.Z,{title:lt.active?"Exit Full Screen":"Enter Full Screen",placement:"right",children:(0,t.jsx)(W.Z,{className:"full-screen-button",onClick:lt.active?lt.exit:lt.enter,shape:"circle",icon:lt.active?(0,t.jsx)(vn.Z,{}):(0,t.jsx)(tt.Z,{})})}),(0,t.jsx)(ut.Z,{title:be?"Hide Toolbar":"Show Toolbar",placement:"right",children:(0,t.jsx)(W.Z,{className:"toolbar-button",onClick:Yi,shape:"circle",icon:be?(0,t.jsx)(Gt.Z,{}):(0,t.jsx)(ht.Z,{})})}),(0,t.jsx)(ut.Z,{title:"Save Graph Data",placement:"right",children:(0,t.jsx)(W.Z,{className:"save-button",onClick:Qi,shape:"circle",icon:(0,t.jsx)(Qt.Z,{})})}),(0,t.jsx)(ut.Z,{title:"Load Graph Data",placement:"right",children:(0,t.jsx)(W.Z,{className:"clear-button",onClick:function(){dn(!0)},shape:"circle",icon:(0,t.jsx)(nt.Z,{})})})]}),(0,t.jsxs)(X.Z,{className:"top-toolbar",children:[(0,t.jsx)(Vr,{onChange:Vi,onAdvancedSearch:fn,getLabels:n.getLabels,getNodeTypes:n.getNodeTypes}),(0,t.jsx)(fo,{onOk:Bi,visible:rn,onCancel:ja,searchObject:Fe,edgeStat:v,parent:document.getElementById("knowledge-graph-container"),apis:n},Fe.node_id)]}),(0,t.jsxs)(we.Z,{className:"graphin",style:{width:"100%",height:"100%",position:"relative"},children:[(0,t.jsx)(_e,{position:"top",width:"300px",height:"100%",closable:!0,title:"Statistics",children:(0,t.jsx)(Co,{nodeStat:q,edgeStat:v})}),(0,t.jsx)(_e,{position:"left",width:"60%",title:"Charts",closable:!0,children:(0,t.jsx)(Zo,{data:y})}),(0,t.jsx)(_e,{position:"right",width:"80%",closable:!1,maskVisible:!0,visible:U,onClose:Na,children:Oe&&e.getGeneInfo&&e.getItems4GenePanel?(0,t.jsx)(Mo,{node:Oe,getGeneInfo:e.getGeneInfo,getItems4GenePanel:e.getItems4GenePanel}):(0,t.jsx)(ke.Z,{description:"No node selected"})}),(0,t.jsx)(_e,{position:"right",width:"80%",closable:!1,maskVisible:!0,visible:Ve,onClose:Na,children:Xn?(0,t.jsx)(Bo,{edgeInfo:Xn}):(0,t.jsx)(ke.Z,{description:"No edge selected"})}),(0,t.jsx)(_e,{position:"bottom",width:"300px",height:"300px",onClick:function(){an("")},children:(0,t.jsxs)($i,{children:[C.length>0?(0,t.jsx)(Ye.Z,{size:"small",scroll:{y:200},rowKey:"identity",dataSource:I,columns:C,pagination:!1,onRow:function(P,R){return{onClick:function(ue){console.log("Click the node item: ",ue,P),an(P.identity),xi([P.identity])}}},rowSelection:(0,m.Z)({type:"radio"},Hi)}):null,C.length>0?(0,t.jsx)(Ye.Z,{size:"small",scroll:{y:200},rowKey:"id",dataSource:B,columns:$,pagination:!1}):null]})}),(0,t.jsxs)(zr,{selectedNode:gi,highlightMode:vi,data:y,layout:ua,style:ti,queriedId:Fe.node_id,statistics:x,toolbarVisible:be,onClearGraph:Li,onEdgeMenuClick:Wi,chatbotVisible:!!e.postMessage,onClickNode:_i,onClickEdge:Ji,onCanvasMenuClick:Ui,changeLayout:function(P){fa(P)},onNodeMenuClick:Ki,children:[ci?(0,t.jsx)(Lt,{onClose:function(){nn(!1),ra("activate")},width:"600px",title:"Node Similarity [t-SNE]",children:(0,t.jsx)(ei,{data:fi,description:'If you expect to highlight nodes on the chart, you need to enable the "Focus" and "Select" mode.',onClick:function(P){an(P.id),ra("focus")}})}):null,(0,t.jsx)(Qo,{visible:Ii,graphs:ki,onLoad:Ai,onDelete:zi,treeFormat:!0,parent:document.getElementById("knowledge-graph-container"),onClose:function(){dn(!1)},onUpload:function(P){wa(P)},selectedGraphId:ln}),(0,t.jsx)(Jo,{visible:Di,payload:Gi,parent:document.getElementById("knowledge-graph-container"),onClose:function(){cn(!1)},onSubmit:function(P){wa(P).finally(function(){cn(!1)})}})]}),u]})]})})})},ai=ni,ri=d(75491),oi=d(41935),ze=d(67569),Jn=24,ii=16,li=function(){var e=(0,l.useState)(""),n=(0,S.Z)(e,2),a=n[0],o=n[1],r=(0,l.useState)(!1),i=(0,S.Z)(r,2),s=i[0],c=i[1],u=(0,l.useState)(Jn),Z=(0,S.Z)(u,2),b=Z[0],y=Z[1];return(0,l.useEffect)(function(){y(s?ii:Jn)},[s]),(0,t.jsxs)(X.Z,{gutter:8,className:"chat-ai-container",children:[s?(0,t.jsx)(we.Z,{xxl:24-b,xl:24-b,lg:24-b,md:24,sm:24,xs:24,children:(0,t.jsx)(Ht.Z,{message:a})}):null,(0,t.jsxs)(we.Z,{xxl:b,xl:b,lg:b,md:24,sm:24,xs:24,children:[(0,t.jsx)(W.Z,{shape:"circle",className:"chat-button",onClick:function(){c(!s)},icon:s?(0,t.jsx)(ri.Z,{}):(0,t.jsx)(oi.Z,{})}),(0,t.jsx)(ai,{apis:{getStatistics:ze.aC,getGraphHistory:ze.Nx,postGraphHistory:ze.xD,deleteGraphHistory:ze.in,getNodeTypes:ze.zX,getLabels:ze.g7,getRelationships:ze.mc,postGraph:ze.zV,postDimensionReduction:ze.jN,postSimilarity:ze.aU},postMessage:function(N){o(N)}})]})]})},si=li},67569:function(Da,jt,d){"use strict";d.d(jt,{jN:function(){return $t},Nx:function(){return Ye},xD:function(){return ke},in:function(){return ve},ix:function(){return me},$7:function(){return Y},P2:function(){return Ae},nx:function(){return et},g7:function(){return Mt},zX:function(){return Gt},zV:function(){return Qt},mc:function(){return t},aU:function(){return _e},aC:function(){return pn}});var Nt=d(93224),X=d(39428),ge=d(11849),W=d(3182),Ne=d(74310),we=null,S=["id"],Ht=["id"],hn=["id"];function $t(A,G){return wt.apply(this,arguments)}function wt(){return wt=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/dimension",(0,ge.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:G},te||{})));case 1:case"end":return w.stop()}},A)})),wt.apply(this,arguments)}function Ye(A,G){return kt.apply(this,arguments)}function kt(){return kt=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/graphs",(0,ge.Z)({method:"GET",params:(0,ge.Z)({},G)},te||{})));case 1:case"end":return w.stop()}},A)})),kt.apply(this,arguments)}function ke(A,G){return Pt.apply(this,arguments)}function Pt(){return Pt=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/graphs",(0,ge.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:G},te||{})));case 1:case"end":return w.stop()}},A)})),Pt.apply(this,arguments)}function ut(A,G){return Et.apply(this,arguments)}function Et(){return Et=_asyncToGenerator(_regeneratorRuntime().mark(function A(G,te){var oe,w;return _regeneratorRuntime().wrap(function(Ze){for(;;)switch(Ze.prev=Ze.next){case 0:return oe=G.id,w=_objectWithoutProperties(G,we),Ze.abrupt("return",request("/api/v1/graphs/".concat(oe),_objectSpread({method:"GET",params:_objectSpread({},w)},te||{})));case 2:case"end":return Ze.stop()}},A)})),Et.apply(this,arguments)}function ve(A,G){return m.apply(this,arguments)}function m(){return m=(0,W.Z)((0,X.Z)().mark(function A(G,te){var oe,w;return(0,X.Z)().wrap(function(Ze){for(;;)switch(Ze.prev=Ze.next){case 0:return oe=G.id,w=(0,Nt.Z)(G,S),Ze.abrupt("return",(0,Ne.WY)("/api/v1/graphs/".concat(oe),(0,ge.Z)({method:"DELETE",params:(0,ge.Z)({},w)},te||{})));case 2:case"end":return Ze.stop()}},A)})),m.apply(this,arguments)}function me(A,G){return It.apply(this,arguments)}function It(){return It=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/knowledges",(0,ge.Z)({method:"GET",params:(0,ge.Z)({},G)},te||{})));case 1:case"end":return w.stop()}},A)})),It.apply(this,arguments)}function Y(A,G){return Tt.apply(this,arguments)}function Tt(){return Tt=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/knowledges",(0,ge.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:G},te||{})));case 1:case"end":return w.stop()}},A)})),Tt.apply(this,arguments)}function Ae(A,G,te){return Dt.apply(this,arguments)}function Dt(){return Dt=(0,W.Z)((0,X.Z)().mark(function A(G,te,oe){var w,at;return(0,X.Z)().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:return w=G.id,at=(0,Nt.Z)(G,Ht),rt.abrupt("return",(0,Ne.WY)("/api/v1/knowledges/".concat(w),(0,ge.Z)({method:"PUT",headers:{"Content-Type":"application/json"},params:(0,ge.Z)({},at),data:te},oe||{})));case 2:case"end":return rt.stop()}},A)})),Dt.apply(this,arguments)}function et(A,G){return l.apply(this,arguments)}function l(){return l=(0,W.Z)((0,X.Z)().mark(function A(G,te){var oe,w;return(0,X.Z)().wrap(function(Ze){for(;;)switch(Ze.prev=Ze.next){case 0:return oe=G.id,w=(0,Nt.Z)(G,hn),Ze.abrupt("return",(0,Ne.WY)("/api/v1/knowledges/".concat(oe),(0,ge.Z)({method:"DELETE",params:(0,ge.Z)({},w)},te||{})));case 2:case"end":return Ze.stop()}},A)})),l.apply(this,arguments)}function Mt(A,G){return ft.apply(this,arguments)}function ft(){return ft=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/labels",(0,ge.Z)({method:"GET",params:(0,ge.Z)({},G)},te||{})));case 1:case"end":return w.stop()}},A)})),ft.apply(this,arguments)}function vn(A,G){return tt.apply(this,arguments)}function tt(){return tt=_asyncToGenerator(_regeneratorRuntime().mark(function A(G,te){return _regeneratorRuntime().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",request("/api/v1/node-properties",_objectSpread({method:"GET",params:_objectSpread({},G)},te||{})));case 1:case"end":return w.stop()}},A)})),tt.apply(this,arguments)}function Gt(A){return ht.apply(this,arguments)}function ht(){return ht=(0,W.Z)((0,X.Z)().mark(function A(G){return(0,X.Z)().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.abrupt("return",(0,Ne.WY)("/api/v1/node-types",(0,ge.Z)({method:"GET"},G||{})));case 1:case"end":return oe.stop()}},A)})),ht.apply(this,arguments)}function Qt(A,G){return nt.apply(this,arguments)}function nt(){return nt=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/nodes",(0,ge.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:G},te||{})));case 1:case"end":return w.stop()}},A)})),nt.apply(this,arguments)}function Ma(A){return vt.apply(this,arguments)}function vt(){return vt=_asyncToGenerator(_regeneratorRuntime().mark(function A(G){return _regeneratorRuntime().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.abrupt("return",request("/api/v1/relationship-types",_objectSpread({method:"GET"},G||{})));case 1:case"end":return oe.stop()}},A)})),vt.apply(this,arguments)}function t(A,G){return pt.apply(this,arguments)}function pt(){return pt=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/relationships",(0,ge.Z)({method:"GET",params:(0,ge.Z)({},G)},te||{})));case 1:case"end":return w.stop()}},A)})),pt.apply(this,arguments)}function _e(A,G){return se.apply(this,arguments)}function se(){return se=(0,W.Z)((0,X.Z)().mark(function A(G,te){return(0,X.Z)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.abrupt("return",(0,Ne.WY)("/api/v1/similarity",(0,ge.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:G},te||{})));case 1:case"end":return w.stop()}},A)})),se.apply(this,arguments)}function pn(A){return Ee.apply(this,arguments)}function Ee(){return Ee=(0,W.Z)((0,X.Z)().mark(function A(G){return(0,X.Z)().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return oe.abrupt("return",(0,Ne.WY)("/api/v1/statistics",(0,ge.Z)({method:"GET"},G||{})));case 1:case"end":return oe.stop()}},A)})),Ee.apply(this,arguments)}},75410:function(){},48628:function(){},31601:function(){},67792:function(){},75042:function(){}}]);
